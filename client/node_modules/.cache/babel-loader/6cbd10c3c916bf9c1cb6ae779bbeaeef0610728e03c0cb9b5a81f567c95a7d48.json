{"ast":null,"code":"import _objectSpread from\"C:/Gamebuddies2/gamebuddies/Gamebuddies.Io/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from'react';import{useSocket}from'../contexts/LazySocketContext';import{useNotification}from'../contexts/NotificationContext';// Import useNotification hook\nimport GamePicker from'./GamePicker';import{useRealtimeSubscription}from'../utils/useRealtimeSubscription';import{getSupabaseClient}from'../utils/supabase';import'./RoomLobby.css';import{jsxs as _jsxs,jsx as _jsx,Fragment as _Fragment}from\"react/jsx-runtime\";const RoomLobby=_ref=>{var _players$find,_roomData$metadata;let{roomCode,playerName,isHost,onLeave}=_ref;const{socket,socketId,isConnected:socketIsConnected,connectSocket}=useSocket();const{addNotification}=useNotification();// Get addNotification function\nconst[players,setPlayers]=useState([]);const[selectedGame,setSelectedGame]=useState(null);const[isLoading,setIsLoading]=useState(true);const[error,setError]=useState(null);// This local error state might still be useful for critical, view-blocking errors\nconst[roomData,setRoomData]=useState(null);// const [connectionStatus, setConnectionStatus] = useState('connecting'); // Replaced by socketIsConnected\nconst[currentIsHost,setCurrentIsHost]=useState(isHost);// State for re-rendering\nconst[roomStatus,setRoomStatus]=useState('waiting_for_players');const[isStartingGame,setIsStartingGame]=useState(false);const[disconnectedTimers,setDisconnectedTimers]=useState(new Map());// Track disconnect timers\n// Use refs for values that shouldn't trigger re-renders\nconst roomCodeRef=useRef(roomCode);const playerNameRef=useRef(playerName);const currentUserIdRef=useRef(null);const roomIdRef=useRef(null);const timerIntervalsRef=useRef(new Map());// Track timer intervals\n// TODO: Review if connectionStatus local state is still needed or if socketIsConnected from context is enough.\n// For now, let's try to use socketIsConnected directly.\n// Function to start disconnect countdown for a player\nconst startDisconnectCountdown=playerId=>{const startTime=Date.now();const countdownDuration=10000;// 10 seconds\n// Clear any existing timer for this player\nif(timerIntervalsRef.current.has(playerId)){clearInterval(timerIntervalsRef.current.get(playerId));}// Set initial countdown\nsetDisconnectedTimers(prev=>new Map(prev.set(playerId,10)));// Start countdown interval\nconst intervalId=setInterval(()=>{const elapsed=Date.now()-startTime;const remaining=Math.max(0,Math.ceil((countdownDuration-elapsed)/1000));setDisconnectedTimers(prev=>{const newMap=new Map(prev);if(remaining>0){newMap.set(playerId,remaining);}else{newMap.delete(playerId);}return newMap;});// Clear interval when countdown reaches 0\nif(remaining<=0){clearInterval(intervalId);timerIntervalsRef.current.delete(playerId);}},1000);timerIntervalsRef.current.set(playerId,intervalId);};// Function to clear disconnect countdown for a player\nconst clearDisconnectCountdown=playerId=>{if(timerIntervalsRef.current.has(playerId)){clearInterval(timerIntervalsRef.current.get(playerId));timerIntervalsRef.current.delete(playerId);}setDisconnectedTimers(prev=>{const newMap=new Map(prev);newMap.delete(playerId);return newMap;});};// Realtime subscription for room members status updates\nuseRealtimeSubscription({table:'room_members',filters:roomIdRef.current?{filter:\"room_id=eq.\".concat(roomIdRef.current)}:{},enabled:!!roomIdRef.current,// Only enable when we have a room ID\nonUpdate:(newRecord,oldRecord)=>{console.log('ðŸ”” [REALTIME] Room member updated:',{newRecord,oldRecord});// Update the specific player in the players array\nsetPlayers(prevPlayers=>prevPlayers.map(player=>{if(player.id===newRecord.user_id){return _objectSpread(_objectSpread({},player),{},{isConnected:newRecord.is_connected,inGame:newRecord.in_game,currentLocation:newRecord.current_location,lastPing:newRecord.last_ping});}return player;}));},onInsert:newRecord=>{console.log('ðŸ”” [REALTIME] New room member:',newRecord);// Handle new player joining - this might need additional user data fetch\nfetchUpdatedPlayerList();},onDelete:deletedRecord=>{console.log('ðŸ”” [REALTIME] Room member left:',deletedRecord);// Remove player from list\nsetPlayers(prevPlayers=>prevPlayers.filter(player=>player.id!==deletedRecord.user_id));},dependencies:[roomIdRef.current]});// Realtime subscription for room status changes\nuseRealtimeSubscription({table:'rooms',filters:roomIdRef.current?{filter:\"id=eq.\".concat(roomIdRef.current)}:{},enabled:!!roomIdRef.current,// Only enable when we have a room ID\nonUpdate:(newRecord,oldRecord)=>{console.log('ðŸ”” [REALTIME] Room updated:',{newRecord,oldRecord});// Update room data and status\nsetRoomData(newRecord);setRoomStatus(newRecord.status);// Update selected game if it changed\nif(newRecord.current_game!==oldRecord.current_game){setSelectedGame(newRecord.current_game!=='lobby'?newRecord.current_game:null);}},dependencies:[roomIdRef.current]});// Function to fetch updated player list with user data\nconst fetchUpdatedPlayerList=async()=>{if(!roomIdRef.current)return;try{const supabase=await getSupabaseClient();if(!supabase){console.error('âŒ Cannot fetch player list - Supabase client not available');return;}const{data:roomMembers,error}=await supabase.from('room_members').select(\"\\n          user_id,\\n          role,\\n          is_connected,\\n          in_game,\\n          current_location,\\n          last_ping,\\n          user:users(username, display_name)\\n        \").eq('room_id',roomIdRef.current);if(error)throw error;const mappedPlayers=(roomMembers===null||roomMembers===void 0?void 0:roomMembers.map(member=>{var _member$user,_member$user2;return{id:member.user_id,name:((_member$user=member.user)===null||_member$user===void 0?void 0:_member$user.display_name)||((_member$user2=member.user)===null||_member$user2===void 0?void 0:_member$user2.username),isHost:member.role==='host',isConnected:member.is_connected,inGame:member.in_game,currentLocation:member.current_location,lastPing:member.last_ping};}))||[];setPlayers(mappedPlayers);}catch(error){console.error('âŒ Error fetching updated player list:',error);}};useEffect(()=>{// Ensure socket connection when RoomLobby mounts\nif(!socket){console.log('ðŸŸ¡ [RoomLobby] Socket not available, connecting...');const activeSocket=connectSocket();if(!activeSocket){setError('Failed to establish connection to server');setIsLoading(false);return;}// Wait for the socket to be available through context\nsetIsLoading(true);return;}// If socket is available but not connected, reflect this.\nif(!socketIsConnected){console.log('ðŸŸ¡ [RoomLobby] Socket available, but not connected. Current status:',socketIsConnected);setIsLoading(true);// Show loading until socket connects\n// The SocketProvider handles connection attempts.\n// We just wait here.\nreturn;}// Socket is available and connected\nconsole.log('ðŸ”Œ [RoomLobby] Socket connected, setting up event listeners. Socket ID:',socket.id);setIsLoading(true);// Start loading until roomJoined is received\n// Named event handlers for proper cleanup\nconst handleConnect=()=>{// This is mostly handled by SocketProvider, but we can log here if specific lobby actions are needed on raw connect\nconsole.log('âœ… [CLIENT] Connected to server in lobby (via RoomLobby listener for existing socket)');console.log('ðŸ” [CLIENT DEBUG] Socket ID:',socket.id);console.log('ðŸ” [CLIENT DEBUG] Room code:',roomCodeRef.current);console.log('ðŸ” [CLIENT DEBUG] Player name:',playerNameRef.current);// Join the room - this is the primary action once the socket is confirmed connected\nconsole.log('ðŸ“¤ [LOBBY DEBUG] Sending joinRoom event...');socket.emit('joinRoom',{roomCode:roomCodeRef.current,playerName:playerNameRef.current});console.log('ðŸ“¤ [CLIENT] joinRoom event sent from lobby');};// If the socket from context is already connected when this component mounts, call handleConnect.\n// Otherwise, the 'connect' event on the socket itself (handled by SocketProvider or a direct listener here)\n// will trigger the join.\nif(socketIsConnected){handleConnect();// Immediately try to join if socket is already connected.\n}else{// If socket is not connected, we rely on SocketProvider's 'connect' event\n// or add a one-time listener here if needed (though SocketProvider should cover it)\nsocket.once('connect',handleConnect);}const handleDisconnect=reason=>{console.log('âŒ [LOBBY DEBUG] Disconnected from server (handled in RoomLobby):',{reason,roomCode:roomCodeRef.current,playerName:playerNameRef.current,timestamp:new Date().toISOString()});// SocketProvider handles setIsConnected(false).\n// setError('Connection lost. Please refresh the page.'); // Critical error, might still use setError\naddNotification('Connection to server lost. Attempting to reconnect...','error');setIsLoading(true);// Show loading as we are disconnected\n};const handleConnectError=error=>{console.error('âŒ [LOBBY DEBUG] Connection error (handled in RoomLobby):',{error:error.message,roomCode:roomCodeRef.current,playerName:playerNameRef.current,timestamp:new Date().toISOString()});// setError('Failed to connect to server. Please try again.'); // Critical error\naddNotification('Failed to connect to server. Please check your internet connection.','error');setIsLoading(false);};const handleRoomJoined=data=>{var _data$players,_data$room,_data$room2,_data$players2,_data$room3,_data$room4,_data$room5,_data$players3,_data$players4,_data$room6,_data$room7,_data$room8;console.log('âœ… [CLIENT] Successfully joined room in lobby:',data);console.log('ðŸ” [CLIENT DEBUG] Lobby join data:',{roomCode:data.roomCode,playerCount:((_data$players=data.players)===null||_data$players===void 0?void 0:_data$players.length)||0,room_id:(_data$room=data.room)===null||_data$room===void 0?void 0:_data$room.id,game_type:(_data$room2=data.room)===null||_data$room2===void 0?void 0:_data$room2.game_type});console.log('ðŸ” [LOBBY DEBUG] Room joined details:',{roomCode:data.roomCode,isHost:data.isHost,playerCount:((_data$players2=data.players)===null||_data$players2===void 0?void 0:_data$players2.length)||0,roomId:(_data$room3=data.room)===null||_data$room3===void 0?void 0:_data$room3.id,gameType:(_data$room4=data.room)===null||_data$room4===void 0?void 0:_data$room4.game_type,roomStatus:(_data$room5=data.room)===null||_data$room5===void 0?void 0:_data$room5.status,participants:((_data$players3=data.players)===null||_data$players3===void 0?void 0:_data$players3.map(p=>({id:p.id,name:p.name,isHost:p.isHost,isConnected:p.isConnected,inGame:p.inGame,currentLocation:p.currentLocation})))||[],timestamp:new Date().toISOString()});// Map players with full status information\nconst mappedPlayers=((_data$players4=data.players)===null||_data$players4===void 0?void 0:_data$players4.map(p=>({id:p.id,name:p.name,isHost:p.isHost,isConnected:p.isConnected!==undefined?p.isConnected:true,inGame:p.inGame||false,currentLocation:p.currentLocation||(p.isConnected?'lobby':'disconnected'),lastPing:p.lastPing})))||[];setPlayers(mappedPlayers);setRoomData(data.room);setRoomStatus(((_data$room6=data.room)===null||_data$room6===void 0?void 0:_data$room6.status)||'waiting_for_players');setSelectedGame(((_data$room7=data.room)===null||_data$room7===void 0?void 0:_data$room7.game_type)!=='lobby'?data.room.game_type:null);// Set room ID for Realtime subscription\nroomIdRef.current=(_data$room8=data.room)===null||_data$room8===void 0?void 0:_data$room8.id;console.log('ðŸ”” [REALTIME] Room ID set for subscription:',roomIdRef.current);// Update host status based on server response\nconst currentUser=mappedPlayers.find(p=>p.name===playerNameRef.current);if(currentUser){console.log(\"\\uD83D\\uDD0D [CLIENT DEBUG] Initial host status: \".concat(playerNameRef.current,\" is host: \").concat(currentUser.isHost));console.log(\"\\uD83D\\uDD0D [LOBBY DEBUG] Host status update:\",{playerName:playerNameRef.current,playerId:currentUser.id,wasHost:currentIsHost,nowHost:currentUser.isHost,changed:currentIsHost!==currentUser.isHost});setCurrentIsHost(currentUser.isHost);currentUserIdRef.current=currentUser.id;// Store user ID for session storage\n}// Auto-update room status based on host location after initial join\nupdateRoomStatusBasedOnHost(mappedPlayers);setIsLoading(false);// Successfully joined, stop loading\nsetError(null);};const handlePlayerJoined=data=>{var _data$player;console.log('ðŸ‘‹ Player joined:',data.player.name);const updatedPlayers=data.players||[];setPlayers(updatedPlayers);setRoomData(data.room);// Clear any disconnect countdown for the joined player\nif((_data$player=data.player)!==null&&_data$player!==void 0&&_data$player.id){clearDisconnectCountdown(data.player.id);}// Ensure host status is maintained when players join\nconst currentUser=updatedPlayers.find(p=>p.name===playerNameRef.current);if(currentUser){if(currentUser.isHost!==currentIsHost){console.log(\"\\uD83D\\uDD0D [CLIENT DEBUG] Host status sync: \".concat(playerNameRef.current,\" is host: \").concat(currentUser.isHost));setCurrentIsHost(currentUser.isHost);}// Update user ID if not already set\nif(!currentUserIdRef.current){currentUserIdRef.current=currentUser.id;}}// Auto-update room status based on host location\nupdateRoomStatusBasedOnHost(updatedPlayers);};const handlePlayerStatusUpdated=data=>{var _data$room9,_data$room9$participa;console.log('ðŸ”„ Player status updated:',data);// Map the players using the updated room participants\nconst mappedPlayers=((_data$room9=data.room)===null||_data$room9===void 0?void 0:(_data$room9$participa=_data$room9.participants)===null||_data$room9$participa===void 0?void 0:_data$room9$participa.map(p=>{var _p$user,_p$user2;return{id:p.user_id,name:((_p$user=p.user)===null||_p$user===void 0?void 0:_p$user.display_name)||((_p$user2=p.user)===null||_p$user2===void 0?void 0:_p$user2.username),isHost:p.role==='host',isConnected:p.is_connected,inGame:p.in_game,currentLocation:p.current_location,lastPing:p.last_ping};}))||[];setPlayers(mappedPlayers);setRoomData(data.room);// Handle host transfer if included in the update\nif(data.hostTransfer){console.log('ðŸ‘‘ Host transfer detected in status update:',data.hostTransfer);// Update local host status if current user is affected\nconst currentUser=mappedPlayers.find(p=>p.name===playerNameRef.current);if(currentUser){const newHostStatus=currentUser.isHost;console.log(\"\\uD83D\\uDD0D [CLIENT DEBUG] Host status update via external game: \".concat(playerNameRef.current,\" is now host: \").concat(newHostStatus));setCurrentIsHost(newHostStatus);}// Show notification about the host transfer\nconst reason=data.hostTransfer.reason==='external_game_disconnect'?'disconnected from game':data.hostTransfer.reason==='original_host_left'?'left the room':'disconnected';console.log(\"\\uD83D\\uDC51 [HOST TRANSFER] \".concat(data.hostTransfer.newHostName,\" is now the host (previous host \").concat(reason,\")\"));// You could add a toast notification here\naddNotification(\"\".concat(data.hostTransfer.newHostName,\" is now the host (previous host \").concat(reason,\")\"),'info');}// Clear disconnect countdown if player reconnected\nif(data.playerId&&data.status==='connected'){clearDisconnectCountdown(data.playerId);}// Auto-update room status based on host location\nupdateRoomStatusBasedOnHost(mappedPlayers);};const handlePlayerLeft=data=>{var _data$players5;console.log('ðŸ‘‹ Player left:',data);// Update players list with complete status information\nsetPlayers(data.players||[]);// Update room data if provided\nif(data.room){setRoomData(data.room);}console.log(\"\\uD83D\\uDC4B [LEAVE DEBUG] Updated player list after leave:\",(_data$players5=data.players)===null||_data$players5===void 0?void 0:_data$players5.map(p=>({name:p.name,isConnected:p.isConnected,currentLocation:p.currentLocation,inGame:p.inGame})));};const handlePlayerDisconnected=data=>{console.log('ðŸ”Œ Player disconnected:',data.playerId);// If we have updated player list, use it; otherwise update connection status\nif(data.players){setPlayers(data.players);}else{setPlayers(prev=>prev.map(player=>player.id===data.playerId?_objectSpread(_objectSpread({},player),{},{isConnected:false}):player));}// Start countdown timer for the disconnected player\nif(data.playerId){startDisconnectCountdown(data.playerId);}};const handleGameSelected=data=>{console.log('ðŸŽ® Game selected:',data.gameType);setSelectedGame(data.gameType);};const handleGameStarted=data=>{console.log('ðŸš€ [LOBBY DEBUG] Game starting event received:',{gameUrl:data.gameUrl,gameType:data.gameType,isHost:data.isHost,roomCode:data.roomCode,currentPlayerName:playerNameRef.current,currentIsHost:currentIsHost,socketId:socket===null||socket===void 0?void 0:socket.id,timestamp:new Date().toISOString()});// Game integration data is passed via URL parameters only\nconsole.log('ðŸŽ® [LOBBY DEBUG] Starting game with URL parameters');console.log('ðŸŽ® [LOBBY DEBUG] Redirecting to game:',data.gameUrl);// Reset starting state since game is actually starting\nsetIsStartingGame(false);// Properly disconnect socket before navigation to prevent WebSocket errors\nif(socket){console.log('ðŸ”Œ [LOBBY DEBUG] Disconnecting socket before game redirect...');socket.disconnect();}// Small delay to ensure disconnect completes before navigation\nsetTimeout(()=>{// Redirect to game\nwindow.location.href=data.gameUrl;},100);};const handleError=error=>{var _error$debug,_error$debug2,_error$debug3,_error$debug4,_error$debug5;console.error('âŒ [LOBBY DEBUG] Socket error received:',{error:error.message||error,code:error.code,debug:error.debug,roomCode:roomCodeRef.current,playerName:playerNameRef.current,timestamp:new Date().toISOString(),// connectionStatus, // This local state is removed\nisLoading,currentError:error// Renamed from 'error' to avoid conflict\n});// Enhanced error handling based on error code\nlet userFriendlyMessage=error.message||'An error occurred';let shouldRedirect=false;// Flag for critical errors that require leaving\nswitch(error.code){case'ROOM_NOT_FOUND':userFriendlyMessage='Room not found. It may have expired or been cleaned up.';shouldRedirect=true;// Critical error - room doesn't exist\nconsole.error('ðŸ” [LOBBY DEBUG] Room not found details:',{roomCode:roomCodeRef.current,searchedFor:(_error$debug=error.debug)===null||_error$debug===void 0?void 0:_error$debug.room_code,timestamp:(_error$debug2=error.debug)===null||_error$debug2===void 0?void 0:_error$debug2.search_timestamp});break;case'ROOM_FULL':userFriendlyMessage='Room is full. Cannot rejoin at this time.';shouldRedirect=true;// Critical error - can't join\nbreak;case'ROOM_NOT_ACCEPTING':userFriendlyMessage=\"Room is \".concat(((_error$debug3=error.debug)===null||_error$debug3===void 0?void 0:_error$debug3.room_status)||'not accepting players',\".\");// Don't redirect - show popup and let user stay in lobby\nconsole.error('ðŸ” [LOBBY DEBUG] Room not accepting details:',{roomStatus:(_error$debug4=error.debug)===null||_error$debug4===void 0?void 0:_error$debug4.room_status,isOriginalCreator:(_error$debug5=error.debug)===null||_error$debug5===void 0?void 0:_error$debug5.is_original_creator});break;case'DUPLICATE_PLAYER':userFriendlyMessage='Player name already in use. Try a different name.';shouldRedirect=true;// Critical error - name conflict\nbreak;case'JOIN_FAILED':userFriendlyMessage='Failed to join room. Please try refreshing the page.';// Don't redirect - let user try actions in lobby\nbreak;case'KICK_FAILED':userFriendlyMessage=error.message||'Failed to kick player. You may not have permission.';// Don't redirect - just show error popup\nbreak;case'NOT_HOST':userFriendlyMessage='Only the host can perform this action.';// Don't redirect - just show error popup\nbreak;default:console.error('ðŸ” [LOBBY DEBUG] Unknown error code:',error.code);// For unknown errors, show popup but don't redirect\n}// For critical errors, use the error state that redirects\nif(shouldRedirect){setError(userFriendlyMessage);setIsLoading(false);}else{// For non-critical errors, show popup and stay in lobby\n// alert(`âš ï¸ ${userFriendlyMessage}`);\naddNotification(userFriendlyMessage,'warning');// If we were loading, stop the loading state\nif(isLoading){setIsLoading(false);}}};const handleHostTransferred=data=>{console.log('ðŸ‘‘ Host transferred:',data);// Update players list with complete status information\nconst updatedPlayers=data.players||[];setPlayers(updatedPlayers);// Update room data if provided\nif(data.room){setRoomData(data.room);}// Update local host status - check if current user is the new host\nconst currentUser=updatedPlayers.find(p=>p.name===playerNameRef.current);if(currentUser){const newHostStatus=currentUser.isHost;console.log(\"\\uD83D\\uDD0D [CLIENT DEBUG] Host status update: \".concat(playerNameRef.current,\" is now host: \").concat(newHostStatus));setCurrentIsHost(newHostStatus);}console.log(\"\\uD83D\\uDC51 [HOST DEBUG] Updated player list after host transfer:\",updatedPlayers.map(p=>({name:p.name,isHost:p.isHost,isConnected:p.isConnected,currentLocation:p.currentLocation,inGame:p.inGame})));// Show notification\nconst reasonText=data.reason==='original_host_left'?'left the room':data.reason==='original_host_disconnected'?'disconnected':'transferred host';addNotification(\"\".concat(data.newHostName,\" is now the host (previous host \").concat(reasonText,\").\"),'info');// Auto-update room status based on new host location\nupdateRoomStatusBasedOnHost(updatedPlayers);};const handleRoomStatusChanged=data=>{console.log('ðŸ”„ Room status changed:',data);// Update room status\nsetRoomStatus(data.newStatus);setRoomData(data.room);// If status changed back to waiting_for_players, reset selected game\nif(data.newStatus==='waiting_for_players'){setSelectedGame(null);}// Show notification (you could implement a toast system here)\naddNotification(\"Room status changed to '\".concat(data.newStatus,\"' by \").concat(data.changedBy,\".\"),'info');};const handlePlayerKicked=data=>{console.log('ðŸ‘¢ [KICK DEBUG] Player kicked event received:',{data,isNotification:data.isNotification,targetUserId:data.targetUserId,reason:data.reason,timestamp:new Date().toISOString()});if(data.isNotification){var _data$players6;// This is a notification to other players about someone being kicked\nconsole.log(\"\\uD83D\\uDC62 [KICK DEBUG] \".concat(data.targetName,\" was kicked by \").concat(data.kickedBy));// Update players list with complete status information\nsetPlayers(data.players||[]);// Update room data if provided\nif(data.room){setRoomData(data.room);}console.log(\"\\uD83D\\uDC62 [KICK DEBUG] Updated player list after kick:\",(_data$players6=data.players)===null||_data$players6===void 0?void 0:_data$players6.map(p=>({name:p.name,isConnected:p.isConnected,currentLocation:p.currentLocation,inGame:p.inGame})));addNotification(\"\".concat(data.targetName,\" was removed from the room by \").concat(data.kickedBy,\".\"),'warning');}else{// This player was kicked personally\nconsole.log('ðŸ‘¢ [KICK DEBUG] You have been kicked from the room:',{reason:data.reason,kickedBy:data.kickedBy,roomCode:data.roomCode});addNotification(\"You have been kicked: \".concat(data.reason,\" (by \").concat(data.kickedBy,\")\"),'error');// Clear socket and leave room\nif(socket){socket.disconnect();// This should trigger SocketProvider's cleanup for this instance\n}// Redirect to homepage\nif(onLeave){onLeave();}}};const handleKickFailed=data=>{console.log('ðŸ‘¢ [KICK DEBUG] Kick failed event received:',{data,error:data.error,reason:data.reason,timestamp:new Date().toISOString()});addNotification(\"Failed to kick player: \".concat(data.reason||data.error||'Unknown error'),'error');};// Add event listeners\n// socket.on('connect', handleConnect); // This is implicitly handled by SocketProvider or initial join\n// socket.on('disconnect', handleDisconnect); // SocketProvider handles global disconnect\n// socket.on('connect_error', handleConnectError); // SocketProvider handles global connect_error\nsocket.on('roomJoined',handleRoomJoined);socket.on('playerJoined',handlePlayerJoined);socket.on('playerLeft',handlePlayerLeft);socket.on('playerDisconnected',handlePlayerDisconnected);socket.on('playerStatusUpdated',handlePlayerStatusUpdated);socket.on('gameSelected',handleGameSelected);socket.on('gameStarted',handleGameStarted);socket.on('hostTransferred',handleHostTransferred);socket.on('roomStatusChanged',handleRoomStatusChanged);socket.on('playerKicked',handlePlayerKicked);socket.on('kickFailed',handleKickFailed);socket.on('error',handleError);// Cleanup function\nreturn()=>{console.log('ðŸ§¹ [RoomLobby] Cleaning up socket event listeners for RoomLobby instance.');// Clear all disconnect timers\ntimerIntervalsRef.current.forEach(intervalId=>{clearInterval(intervalId);});timerIntervalsRef.current.clear();setDisconnectedTimers(new Map());if(socket){// Remove event listeners\n// socket.off('connect', handleConnect);\n// socket.off('disconnect', handleDisconnect);\n// socket.off('connect_error', handleConnectError);\nsocket.off('roomJoined',handleRoomJoined);socket.off('playerJoined',handlePlayerJoined);socket.off('playerLeft',handlePlayerLeft);socket.off('playerDisconnected',handlePlayerDisconnected);socket.off('playerStatusUpdated',handlePlayerStatusUpdated);socket.off('gameSelected',handleGameSelected);socket.off('gameStarted',handleGameStarted);socket.off('hostTransferred',handleHostTransferred);socket.off('roomStatusChanged',handleRoomStatusChanged);socket.off('playerKicked',handlePlayerKicked);socket.off('kickFailed',handleKickFailed);socket.off('error',handleError);// Emit leaveRoom only if the socket is still connected\n// The main disconnect is handled by SocketProvider when App unmounts\nif(socket.connected){const currentRoomCode=roomCodeRef.current;if(currentRoomCode){console.log('ðŸ“¤ [RoomLobby] Emitting leaveRoom on unmount/cleanup for room:',currentRoomCode);socket.emit('leaveRoom',{roomCode:currentRoomCode});}}}};},[socket,socketIsConnected]);// Effect dependencies: socket instance and its connection status\n// Add beforeunload handler to cleanup WebSocket on navigation\nuseEffect(()=>{const handleBeforeUnload=()=>{if(socket&&socket.connected){console.log('ðŸ”Œ [LOBBY DEBUG] Cleaning up socket before page unload...');socket.disconnect();}};window.addEventListener('beforeunload',handleBeforeUnload);return()=>{window.removeEventListener('beforeunload',handleBeforeUnload);};},[socket]);const handleGameSelect=gameType=>{if(socket&&socketIsConnected&&currentIsHost){console.log('ðŸŽ® Selecting game:',gameType);socket.emit('selectGame',{gameType});}};const handleStartGame=()=>{// Prevent multiple rapid clicks\nif(isStartingGame){console.log('ðŸš€ [START GAME DEBUG] Game start already in progress, ignoring click');return;}if(socket&&socketIsConnected&&currentIsHost){console.log('ðŸš€ [START GAME DEBUG] Starting game:',{socketConnected:socket.connected,// socketIsConnected from context\nsocketId:socket.id,// socketId from context\nroomCode:roomCodeRef.current,playerName:playerNameRef.current,isHost:currentIsHost,// connectionStatus, // Removed\nisStartingGame,timestamp:new Date().toISOString()});// Redundant check, socketIsConnected should cover this\n// if (!socket.connected) {\n//   console.error('âŒ [START GAME DEBUG] Socket not connected, cannot start game');\n//   addNotification('Connection lost. Please refresh the page and try again.', 'error');\n//   return;\n// }\nsetIsStartingGame(true);addNotification('Starting game...','info');console.log('ðŸ“¤ [START GAME DEBUG] Emitting startGame event');socket.emit('startGame',{roomCode:roomCodeRef.current});// Reset after a delay to allow for game start\nsetTimeout(()=>{setIsStartingGame(false);},5000);}else{console.error('âŒ [START GAME DEBUG] Cannot start game:',{hasSocket:!!socket,isHost:currentIsHost,socketConnected:socketIsConnected,// connectionStatus, // Removed\nisStartingGame});if(!currentIsHost){addNotification('Only the host can start the game.','warning');}else if(!socket||!socketIsConnected){addNotification('Connection lost. Please refresh the page and try again.','error');}}};const handleLeaveRoom=()=>{if(socket&&socketIsConnected){socket.emit('leaveRoom',{roomCode:roomCodeRef.current});}if(onLeave){onLeave();}};const handleTransferHost=targetPlayerId=>{if(socket&&socketIsConnected&&currentIsHost){console.log('ðŸ‘‘ Transferring host to player:',targetPlayerId);socket.emit('transferHost',{roomCode:roomCodeRef.current,targetUserId:targetPlayerId});}};const handleKickPlayer=(targetPlayerId,targetPlayerName)=>{if(socket&&socketIsConnected&&currentIsHost){// Confirm kick action\nconst confirmed=window.confirm(\"Are you sure you want to kick \".concat(targetPlayerName,\" from the room?\"));if(confirmed){console.log('ðŸ‘¢ [KICK DEBUG] Kicking player:',{targetPlayerId,targetPlayerName,roomCode:roomCodeRef.current,timestamp:new Date().toISOString()});socket.emit('kickPlayer',{roomCode:roomCodeRef.current,targetUserId:targetPlayerId});}else{console.log('ðŸ‘¢ [KICK DEBUG] Kick cancelled by host');}}};const handleReturnToLobby=()=>{if(socket&&socketIsConnected){console.log('ðŸ”„ Player returning to lobby');socket.emit('playerReturnToLobby',{roomCode:roomCodeRef.current,playerName:playerNameRef.current});// If current user is host, automatically update room status to lobby\nif(currentIsHost){console.log('ðŸ”„ Host returning to lobby - auto-updating room status');// The status will be updated when we receive the playerStatusUpdated event\n// but we can also trigger it immediately for responsiveness\nsetTimeout(()=>{// Re-fetch current player status and update room status\nconst currentPlayer=players.find(p=>p.name===playerNameRef.current);if(currentPlayer){const updatedPlayers=players.map(p=>p.name===playerNameRef.current?_objectSpread(_objectSpread({},p),{},{inGame:false,currentLocation:'lobby'}):p);updateRoomStatusBasedOnHost(updatedPlayers);}},100);}}};// Automatic status management based on host location\nconst updateRoomStatusBasedOnHost=updatedPlayers=>{if(!currentIsHost||!socket||!socketIsConnected)return;const currentHost=updatedPlayers.find(p=>p.isHost);if(!currentHost)return;let targetStatus='waiting_for_players';// Determine status based on host location\nif(currentHost.currentLocation==='game'||currentHost.inGame){targetStatus='in_game';}else if(currentHost.currentLocation==='lobby'||!currentHost.inGame&&currentHost.isConnected){targetStatus='waiting_for_players';}// Only update if status needs to change\nif(targetStatus!==roomStatus){console.log('ðŸ”„ Auto-updating room status based on host location:',{hostLocation:currentHost.currentLocation,hostInGame:currentHost.inGame,currentStatus:roomStatus,newStatus:targetStatus});// Update room status automatically\nsocket.emit('autoUpdateRoomStatus',{roomCode:roomCodeRef.current,newStatus:targetStatus,reason:'host_location_change'});}};// Helper function to get player status\nconst getPlayerStatus=player=>{console.log(\"\\uD83D\\uDD0D [STATUS DEBUG] Getting status for \".concat(player.name,\":\"),{currentLocation:player.currentLocation,isConnected:player.isConnected,inGame:player.inGame,lastPing:player.lastPing});// Use currentLocation if available, otherwise fall back to old logic\nif(player.currentLocation){switch(player.currentLocation){case'game':return{status:'in_game',label:'In Game',color:'#ff6b35',icon:'ðŸŽ®'};case'lobby':return{status:'lobby',label:'In Lobby',color:'#4caf50',icon:'ðŸŸ¢'};case'disconnected':return{status:'disconnected',label:'Offline',color:'#666',icon:'âš«'};default:console.warn(\"\\uD83D\\uDD0D [STATUS DEBUG] Unknown currentLocation: \".concat(player.currentLocation,\", falling back to lobby\"));return{status:'lobby',label:'In Lobby',color:'#4caf50',icon:'ðŸŸ¢'};}}// Fallback to old logic for backward compatibility\nconsole.log(\"\\uD83D\\uDD0D [STATUS DEBUG] No currentLocation for \".concat(player.name,\", using fallback logic\"));if(!player.isConnected){return{status:'disconnected',label:'Offline',color:'#666',icon:'âš«'};}if(player.inGame){return{status:'in_game',label:'In Game',color:'#ff6b35',icon:'ðŸŽ®'};}return{status:'lobby',label:'In Lobby',color:'#4caf50',icon:'ðŸŸ¢'};};// Loading state\nif(isLoading||!socketIsConnected){// Also show loading if socket is not connected yet\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"room-lobby\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"lobby-header\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Room \",roomCode]}),/*#__PURE__*/_jsxs(\"div\",{className:\"connection-status\",children:[\"Status: \",socketIsConnected?'Connected':'Connecting...',\" \"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"loading-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:socketIsConnected?'Joining room...':'Connecting to server...'})]})]});}// Error state\nif(error){return/*#__PURE__*/_jsxs(\"div\",{className:\"room-lobby\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"lobby-header\",children:/*#__PURE__*/_jsxs(\"h2\",{children:[\"Room \",roomCode]})}),/*#__PURE__*/_jsx(\"div\",{className:\"error-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"error-message\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Connection Error\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"div\",{className:\"error-actions\",children:/*#__PURE__*/_jsx(\"button\",{onClick:handleLeaveRoom,className:\"leave-button\",children:\"Leave Room\"})})]})})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"room-lobby\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"lobby-header\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleLeaveRoom,className:\"leave-button\",children:\"Leave Room\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"room-info-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"room-code-display\",children:roomCode}),/*#__PURE__*/_jsx(\"div\",{className:\"room-status-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"room-status-display\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"status-label\",children:\"Status:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"status-badge status-\".concat(roomStatus),children:roomStatus.replace(/_/g,' ').replace(/\\b\\w/g,l=>l.toUpperCase())})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"room-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"copy-btn\",onClick:()=>navigator.clipboard.writeText(roomCode),children:\"\\uD83D\\uDCCB Copy Code\"}),/*#__PURE__*/_jsx(\"button\",{className:\"copy-link-btn\",onClick:()=>{const roomUrl=\"\".concat(window.location.origin,\"/?join=\").concat(roomCode);navigator.clipboard.writeText(roomUrl);},children:\"\\uD83D\\uDD17 Copy Link\"})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{width:'120px'}}),\" \"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"lobby-content\",children:[!currentIsHost&&roomStatus!=='waiting_for_players'&&/*#__PURE__*/_jsx(\"div\",{className:\"status-info-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"status-info-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"status-info-icon\",children:[roomStatus==='active'&&'ðŸ”µ',roomStatus==='paused'&&'ðŸŸ¡',roomStatus==='finished'&&'ðŸ”´',roomStatus==='abandoned'&&'âš«',roomStatus==='launching'&&'ï¿½ï¿½']}),/*#__PURE__*/_jsxs(\"div\",{className:\"status-info-content\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"status-info-title\",children:[\"Room is \",roomStatus.replace(/_/g,' ').replace(/\\b\\w/g,l=>l.toUpperCase())]}),/*#__PURE__*/_jsxs(\"p\",{className:\"status-info-description\",children:[roomStatus==='active'&&'The room is currently active. New players cannot join right now.',roomStatus==='paused'&&'The room is paused. The host can resume or change the status.',roomStatus==='finished'&&'This room has finished. The host can reopen it for new players.',roomStatus==='abandoned'&&'This room has been abandoned. The host can reactivate it.',roomStatus==='launching'&&'The room is launching. Please wait for the game to start.']})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"players-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"section-title\",children:\"Players in Room\"}),((_players$find=players.find(p=>p.name===playerNameRef.current))===null||_players$find===void 0?void 0:_players$find.inGame)&&/*#__PURE__*/_jsx(\"button\",{className:\"return-to-lobby-btn\",onClick:handleReturnToLobby,title:\"Mark yourself as returned to lobby\",children:\"\\uD83D\\uDD04 Return to Lobby\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"players-grid\",children:players.filter(player=>{// Show connected players\nif(player.isConnected)return true;// Show disconnected players only if they still have a countdown timer\nif(!player.isConnected&&disconnectedTimers.has(player.id)){return true;}// Hide disconnected players after countdown expires\nreturn false;}).map(player=>{const playerStatus=getPlayerStatus(player);const countdownTime=disconnectedTimers.get(player.id);const isDisconnectedWithTimer=!player.isConnected&&countdownTime>0;return/*#__PURE__*/_jsxs(\"div\",{className:\"player-card \".concat(player.isHost?'host':'',\" \").concat(playerStatus.status,\" \").concat(isDisconnectedWithTimer?'disconnecting':''),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"player-card-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"player-avatar\",children:player.name.charAt(0).toUpperCase()}),/*#__PURE__*/_jsxs(\"div\",{className:\"player-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"player-name\",children:player.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"player-badges\",children:[player.isHost&&/*#__PURE__*/_jsx(\"span\",{className:\"host-badge\",children:\"Host\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"status-badge\",style:{backgroundColor:playerStatus.color},title:\"\".concat(player.name,\" is \").concat(playerStatus.label.toLowerCase()),children:[playerStatus.icon,\" \",playerStatus.label]}),isDisconnectedWithTimer&&/*#__PURE__*/_jsxs(\"span\",{className:\"countdown-badge\",title:\"Time until removed from room\",children:[\"\\u23F1\\uFE0F \",countdownTime,\"s\"]})]})]})]}),currentIsHost&&!player.isHost&&!isDisconnectedWithTimer&&/*#__PURE__*/_jsxs(\"div\",{className:\"player-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"make-host-btn\",onClick:()=>handleTransferHost(player.id),title:\"Make \".concat(player.name,\" the host\"),children:\"\\uD83D\\uDC51 Make Host\"}),/*#__PURE__*/_jsx(\"button\",{className:\"kick-player-btn\",onClick:()=>handleKickPlayer(player.id,player.name),title:\"Kick \".concat(player.name,\" from the room\"),children:\"\\uD83D\\uDC62 Kick\"})]})]},player.id);})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-section\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"section-title\",children:\"Game Selection\"}),!selectedGame?/*#__PURE__*/_jsx(GamePicker,{onGameSelect:handleGameSelect,isHost:currentIsHost,disabled:!socket||!socketIsConnected// Use socketIsConnected\n}):/*#__PURE__*/_jsxs(\"div\",{className:\"selected-game-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"game-icon\",children:selectedGame==='ddf'?'ðŸŽ®':selectedGame==='schooled'?'ðŸŽ“':selectedGame==='susd'?'ðŸ”':'ðŸŽ®'}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-details\",children:[/*#__PURE__*/_jsx(\"h4\",{children:selectedGame==='ddf'?'Der dÃ¼mmste fliegt':selectedGame==='schooled'?'School Quiz':selectedGame==='susd'?'SUS\\'D':selectedGame}),/*#__PURE__*/_jsx(\"p\",{children:selectedGame==='ddf'?'Quiz game where the worst player gets eliminated':selectedGame==='schooled'?'Educational quiz game for students':selectedGame==='susd'?'Imposter game - find who\\'s acting suspicious!':'Unknown game'}),/*#__PURE__*/_jsxs(\"span\",{className:\"max-players\",children:[\"Max \",selectedGame==='ddf'?'8':selectedGame==='schooled'?'10':selectedGame==='susd'?'10':'8',\" players\"]})]}),currentIsHost&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleStartGame,className:\"start-game-button\",disabled:!socket||!socketIsConnected||isStartingGame// Use socketIsConnected\n,children:isStartingGame?'Starting Game...':'Start Game'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setSelectedGame(null);if(socket&&socketIsConnected){// Also emit game deselection if needed\nsocket.emit('selectGame',{gameType:null});// Assuming server handles null as deselection\n}},className:\"change-game-btn\",disabled:!socket||!socketIsConnected// Use socketIsConnected\n,style:{marginTop:'1rem'},children:\"Change Game\"})]}),!currentIsHost&&/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center'},children:/*#__PURE__*/_jsx(\"p\",{children:\"Waiting for host to start the game...\"})})]})]})]}),roomData&&/*#__PURE__*/_jsx(\"div\",{className:\"room-details\",children:/*#__PURE__*/_jsxs(\"small\",{children:[\"Room created: \",new Date(roomData.created_at).toLocaleString(),((_roomData$metadata=roomData.metadata)===null||_roomData$metadata===void 0?void 0:_roomData$metadata.created_by_name)&&/*#__PURE__*/_jsxs(_Fragment,{children:[\" by \",roomData.metadata.created_by_name]})]})})]});};export default RoomLobby;","map":{"version":3,"names":["React","useState","useEffect","useRef","useSocket","useNotification","GamePicker","useRealtimeSubscription","getSupabaseClient","jsxs","_jsxs","jsx","_jsx","Fragment","_Fragment","RoomLobby","_ref","_players$find","_roomData$metadata","roomCode","playerName","isHost","onLeave","socket","socketId","isConnected","socketIsConnected","connectSocket","addNotification","players","setPlayers","selectedGame","setSelectedGame","isLoading","setIsLoading","error","setError","roomData","setRoomData","currentIsHost","setCurrentIsHost","roomStatus","setRoomStatus","isStartingGame","setIsStartingGame","disconnectedTimers","setDisconnectedTimers","Map","roomCodeRef","playerNameRef","currentUserIdRef","roomIdRef","timerIntervalsRef","startDisconnectCountdown","playerId","startTime","Date","now","countdownDuration","current","has","clearInterval","get","prev","set","intervalId","setInterval","elapsed","remaining","Math","max","ceil","newMap","delete","clearDisconnectCountdown","table","filters","filter","concat","enabled","onUpdate","newRecord","oldRecord","console","log","prevPlayers","map","player","id","user_id","_objectSpread","is_connected","inGame","in_game","currentLocation","current_location","lastPing","last_ping","onInsert","fetchUpdatedPlayerList","onDelete","deletedRecord","dependencies","status","current_game","supabase","data","roomMembers","from","select","eq","mappedPlayers","member","_member$user","_member$user2","name","user","display_name","username","role","activeSocket","handleConnect","emit","once","handleDisconnect","reason","timestamp","toISOString","handleConnectError","message","handleRoomJoined","_data$players","_data$room","_data$room2","_data$players2","_data$room3","_data$room4","_data$room5","_data$players3","_data$players4","_data$room6","_data$room7","_data$room8","playerCount","length","room_id","room","game_type","roomId","gameType","participants","p","undefined","currentUser","find","wasHost","nowHost","changed","updateRoomStatusBasedOnHost","handlePlayerJoined","_data$player","updatedPlayers","handlePlayerStatusUpdated","_data$room9","_data$room9$participa","_p$user","_p$user2","hostTransfer","newHostStatus","newHostName","handlePlayerLeft","_data$players5","handlePlayerDisconnected","handleGameSelected","handleGameStarted","gameUrl","currentPlayerName","disconnect","setTimeout","window","location","href","handleError","_error$debug","_error$debug2","_error$debug3","_error$debug4","_error$debug5","code","debug","currentError","userFriendlyMessage","shouldRedirect","searchedFor","room_code","search_timestamp","room_status","isOriginalCreator","is_original_creator","handleHostTransferred","reasonText","handleRoomStatusChanged","newStatus","changedBy","handlePlayerKicked","isNotification","targetUserId","_data$players6","targetName","kickedBy","handleKickFailed","on","forEach","clear","off","connected","currentRoomCode","handleBeforeUnload","addEventListener","removeEventListener","handleGameSelect","handleStartGame","socketConnected","hasSocket","handleLeaveRoom","handleTransferHost","targetPlayerId","handleKickPlayer","targetPlayerName","confirmed","confirm","handleReturnToLobby","currentPlayer","currentHost","targetStatus","hostLocation","hostInGame","currentStatus","getPlayerStatus","label","color","icon","warn","className","children","onClick","replace","l","toUpperCase","navigator","clipboard","writeText","roomUrl","origin","style","width","title","playerStatus","countdownTime","isDisconnectedWithTimer","charAt","backgroundColor","toLowerCase","onGameSelect","disabled","marginTop","textAlign","created_at","toLocaleString","metadata","created_by_name"],"sources":["C:/Gamebuddies2/gamebuddies/Gamebuddies.Io/client/src/components/RoomLobby.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useSocket } from '../contexts/LazySocketContext';\r\nimport { useNotification } from '../contexts/NotificationContext'; // Import useNotification hook\r\nimport GamePicker from './GamePicker';\r\nimport { useRealtimeSubscription } from '../utils/useRealtimeSubscription';\r\nimport { getSupabaseClient } from '../utils/supabase';\r\nimport './RoomLobby.css';\r\n\r\nconst RoomLobby = ({ roomCode, playerName, isHost, onLeave }) => {\r\n  const { socket, socketId, isConnected: socketIsConnected, connectSocket } = useSocket();\r\n  const { addNotification } = useNotification(); // Get addNotification function\r\n  const [players, setPlayers] = useState([]);\r\n  const [selectedGame, setSelectedGame] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState(null); // This local error state might still be useful for critical, view-blocking errors\r\n  const [roomData, setRoomData] = useState(null);\r\n  // const [connectionStatus, setConnectionStatus] = useState('connecting'); // Replaced by socketIsConnected\r\n  const [currentIsHost, setCurrentIsHost] = useState(isHost); // State for re-rendering\r\n  const [roomStatus, setRoomStatus] = useState('waiting_for_players');\r\n  const [isStartingGame, setIsStartingGame] = useState(false);\r\n  const [disconnectedTimers, setDisconnectedTimers] = useState(new Map()); // Track disconnect timers\r\n  \r\n  // Use refs for values that shouldn't trigger re-renders\r\n  const roomCodeRef = useRef(roomCode);\r\n  const playerNameRef = useRef(playerName);\r\n  const currentUserIdRef = useRef(null);\r\n  const roomIdRef = useRef(null);\r\n  const timerIntervalsRef = useRef(new Map()); // Track timer intervals\r\n\r\n  // TODO: Review if connectionStatus local state is still needed or if socketIsConnected from context is enough.\r\n  // For now, let's try to use socketIsConnected directly.\r\n\r\n  // Function to start disconnect countdown for a player\r\n  const startDisconnectCountdown = (playerId) => {\r\n    const startTime = Date.now();\r\n    const countdownDuration = 10000; // 10 seconds\r\n    \r\n    // Clear any existing timer for this player\r\n    if (timerIntervalsRef.current.has(playerId)) {\r\n      clearInterval(timerIntervalsRef.current.get(playerId));\r\n    }\r\n    \r\n    // Set initial countdown\r\n    setDisconnectedTimers(prev => new Map(prev.set(playerId, 10)));\r\n    \r\n    // Start countdown interval\r\n    const intervalId = setInterval(() => {\r\n      const elapsed = Date.now() - startTime;\r\n      const remaining = Math.max(0, Math.ceil((countdownDuration - elapsed) / 1000));\r\n      \r\n      setDisconnectedTimers(prev => {\r\n        const newMap = new Map(prev);\r\n        if (remaining > 0) {\r\n          newMap.set(playerId, remaining);\r\n        } else {\r\n          newMap.delete(playerId);\r\n        }\r\n        return newMap;\r\n      });\r\n      \r\n      // Clear interval when countdown reaches 0\r\n      if (remaining <= 0) {\r\n        clearInterval(intervalId);\r\n        timerIntervalsRef.current.delete(playerId);\r\n      }\r\n    }, 1000);\r\n    \r\n    timerIntervalsRef.current.set(playerId, intervalId);\r\n  };\r\n\r\n  // Function to clear disconnect countdown for a player\r\n  const clearDisconnectCountdown = (playerId) => {\r\n    if (timerIntervalsRef.current.has(playerId)) {\r\n      clearInterval(timerIntervalsRef.current.get(playerId));\r\n      timerIntervalsRef.current.delete(playerId);\r\n    }\r\n    setDisconnectedTimers(prev => {\r\n      const newMap = new Map(prev);\r\n      newMap.delete(playerId);\r\n      return newMap;\r\n    });\r\n  };\r\n\r\n  // Realtime subscription for room members status updates\r\n  useRealtimeSubscription({\r\n    table: 'room_members',\r\n    filters: roomIdRef.current ? { filter: `room_id=eq.${roomIdRef.current}` } : {},\r\n    enabled: !!roomIdRef.current, // Only enable when we have a room ID\r\n    onUpdate: (newRecord, oldRecord) => {\r\n      console.log('ðŸ”” [REALTIME] Room member updated:', { newRecord, oldRecord });\r\n      \r\n      // Update the specific player in the players array\r\n      setPlayers(prevPlayers => \r\n        prevPlayers.map(player => {\r\n          if (player.id === newRecord.user_id) {\r\n            return {\r\n              ...player,\r\n              isConnected: newRecord.is_connected,\r\n              inGame: newRecord.in_game,\r\n              currentLocation: newRecord.current_location,\r\n              lastPing: newRecord.last_ping\r\n            };\r\n          }\r\n          return player;\r\n        })\r\n      );\r\n    },\r\n    onInsert: (newRecord) => {\r\n      console.log('ðŸ”” [REALTIME] New room member:', newRecord);\r\n      // Handle new player joining - this might need additional user data fetch\r\n      fetchUpdatedPlayerList();\r\n    },\r\n    onDelete: (deletedRecord) => {\r\n      console.log('ðŸ”” [REALTIME] Room member left:', deletedRecord);\r\n      // Remove player from list\r\n      setPlayers(prevPlayers => \r\n        prevPlayers.filter(player => player.id !== deletedRecord.user_id)\r\n      );\r\n    },\r\n    dependencies: [roomIdRef.current]\r\n  });\r\n\r\n  // Realtime subscription for room status changes\r\n  useRealtimeSubscription({\r\n    table: 'rooms',\r\n    filters: roomIdRef.current ? { filter: `id=eq.${roomIdRef.current}` } : {},\r\n    enabled: !!roomIdRef.current, // Only enable when we have a room ID\r\n    onUpdate: (newRecord, oldRecord) => {\r\n      console.log('ðŸ”” [REALTIME] Room updated:', { newRecord, oldRecord });\r\n      \r\n      // Update room data and status\r\n      setRoomData(newRecord);\r\n      setRoomStatus(newRecord.status);\r\n      \r\n      // Update selected game if it changed\r\n      if (newRecord.current_game !== oldRecord.current_game) {\r\n        setSelectedGame(newRecord.current_game !== 'lobby' ? newRecord.current_game : null);\r\n      }\r\n    },\r\n    dependencies: [roomIdRef.current]\r\n  });\r\n\r\n  // Function to fetch updated player list with user data\r\n  const fetchUpdatedPlayerList = async () => {\r\n    if (!roomIdRef.current) return;\r\n    \r\n    try {\r\n      const supabase = await getSupabaseClient();\r\n      if (!supabase) {\r\n        console.error('âŒ Cannot fetch player list - Supabase client not available');\r\n        return;\r\n      }\r\n\r\n      const { data: roomMembers, error } = await supabase\r\n        .from('room_members')\r\n        .select(`\r\n          user_id,\r\n          role,\r\n          is_connected,\r\n          in_game,\r\n          current_location,\r\n          last_ping,\r\n          user:users(username, display_name)\r\n        `)\r\n        .eq('room_id', roomIdRef.current);\r\n\r\n      if (error) throw error;\r\n\r\n      const mappedPlayers = roomMembers?.map(member => ({\r\n        id: member.user_id,\r\n        name: member.user?.display_name || member.user?.username,\r\n        isHost: member.role === 'host',\r\n        isConnected: member.is_connected,\r\n        inGame: member.in_game,\r\n        currentLocation: member.current_location,\r\n        lastPing: member.last_ping\r\n      })) || [];\r\n\r\n      setPlayers(mappedPlayers);\r\n    } catch (error) {\r\n      console.error('âŒ Error fetching updated player list:', error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Ensure socket connection when RoomLobby mounts\r\n    if (!socket) {\r\n      console.log('ðŸŸ¡ [RoomLobby] Socket not available, connecting...');\r\n      const activeSocket = connectSocket();\r\n      if (!activeSocket) {\r\n        setError('Failed to establish connection to server');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n      // Wait for the socket to be available through context\r\n      setIsLoading(true);\r\n      return;\r\n    }\r\n    \r\n    // If socket is available but not connected, reflect this.\r\n    if (!socketIsConnected) {\r\n      console.log('ðŸŸ¡ [RoomLobby] Socket available, but not connected. Current status:', socketIsConnected);\r\n      setIsLoading(true); // Show loading until socket connects\r\n      // The SocketProvider handles connection attempts.\r\n      // We just wait here.\r\n      return;\r\n    }\r\n\r\n    // Socket is available and connected\r\n    console.log('ðŸ”Œ [RoomLobby] Socket connected, setting up event listeners. Socket ID:', socket.id);\r\n    setIsLoading(true); // Start loading until roomJoined is received\r\n\r\n    // Named event handlers for proper cleanup\r\n    const handleConnect = () => {\r\n      // This is mostly handled by SocketProvider, but we can log here if specific lobby actions are needed on raw connect\r\n      console.log('âœ… [CLIENT] Connected to server in lobby (via RoomLobby listener for existing socket)');\r\n      console.log('ðŸ” [CLIENT DEBUG] Socket ID:', socket.id);\r\n      console.log('ðŸ” [CLIENT DEBUG] Room code:', roomCodeRef.current);\r\n      console.log('ðŸ” [CLIENT DEBUG] Player name:', playerNameRef.current);\r\n      \r\n      // Join the room - this is the primary action once the socket is confirmed connected\r\n      console.log('ðŸ“¤ [LOBBY DEBUG] Sending joinRoom event...');\r\n      socket.emit('joinRoom', {\r\n        roomCode: roomCodeRef.current,\r\n        playerName: playerNameRef.current\r\n      });\r\n      console.log('ðŸ“¤ [CLIENT] joinRoom event sent from lobby');\r\n    };\r\n\r\n    // If the socket from context is already connected when this component mounts, call handleConnect.\r\n    // Otherwise, the 'connect' event on the socket itself (handled by SocketProvider or a direct listener here)\r\n    // will trigger the join.\r\n    if (socketIsConnected) {\r\n       handleConnect(); // Immediately try to join if socket is already connected.\r\n    } else {\r\n      // If socket is not connected, we rely on SocketProvider's 'connect' event\r\n      // or add a one-time listener here if needed (though SocketProvider should cover it)\r\n      socket.once('connect', handleConnect);\r\n    }\r\n\r\n\r\n    const handleDisconnect = (reason) => {\r\n      console.log('âŒ [LOBBY DEBUG] Disconnected from server (handled in RoomLobby):', {\r\n        reason,\r\n        roomCode: roomCodeRef.current,\r\n        playerName: playerNameRef.current,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n      // SocketProvider handles setIsConnected(false).\r\n      // setError('Connection lost. Please refresh the page.'); // Critical error, might still use setError\r\n      addNotification('Connection to server lost. Attempting to reconnect...', 'error');\r\n      setIsLoading(true); // Show loading as we are disconnected\r\n    };\r\n\r\n    const handleConnectError = (error) => {\r\n      console.error('âŒ [LOBBY DEBUG] Connection error (handled in RoomLobby):', {\r\n        error: error.message,\r\n        roomCode: roomCodeRef.current,\r\n        playerName: playerNameRef.current,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n      // setError('Failed to connect to server. Please try again.'); // Critical error\r\n      addNotification('Failed to connect to server. Please check your internet connection.', 'error');\r\n      setIsLoading(false);\r\n    };\r\n\r\n    const handleRoomJoined = (data) => {\r\n      console.log('âœ… [CLIENT] Successfully joined room in lobby:', data);\r\n      console.log('ðŸ” [CLIENT DEBUG] Lobby join data:', {\r\n        roomCode: data.roomCode,\r\n        playerCount: data.players?.length || 0,\r\n        room_id: data.room?.id,\r\n        game_type: data.room?.game_type\r\n      });\r\n      console.log('ðŸ” [LOBBY DEBUG] Room joined details:', {\r\n        roomCode: data.roomCode,\r\n        isHost: data.isHost,\r\n        playerCount: data.players?.length || 0,\r\n        roomId: data.room?.id,\r\n        gameType: data.room?.game_type,\r\n        roomStatus: data.room?.status,\r\n        participants: data.players?.map(p => ({\r\n          id: p.id,\r\n          name: p.name,\r\n          isHost: p.isHost,\r\n          isConnected: p.isConnected,\r\n          inGame: p.inGame,\r\n          currentLocation: p.currentLocation\r\n        })) || [],\r\n        timestamp: new Date().toISOString()\r\n      });\r\n      \r\n      // Map players with full status information\r\n      const mappedPlayers = data.players?.map(p => ({\r\n        id: p.id,\r\n        name: p.name,\r\n        isHost: p.isHost,\r\n        isConnected: p.isConnected !== undefined ? p.isConnected : true,\r\n        inGame: p.inGame || false,\r\n        currentLocation: p.currentLocation || (p.isConnected ? 'lobby' : 'disconnected'),\r\n        lastPing: p.lastPing\r\n      })) || [];\r\n      \r\n      setPlayers(mappedPlayers);\r\n      setRoomData(data.room);\r\n      setRoomStatus(data.room?.status || 'waiting_for_players');\r\n      setSelectedGame(data.room?.game_type !== 'lobby' ? data.room.game_type : null);\r\n      \r\n      // Set room ID for Realtime subscription\r\n      roomIdRef.current = data.room?.id;\r\n      console.log('ðŸ”” [REALTIME] Room ID set for subscription:', roomIdRef.current);\r\n      \r\n      // Update host status based on server response\r\n      const currentUser = mappedPlayers.find(p => p.name === playerNameRef.current);\r\n      if (currentUser) {\r\n        console.log(`ðŸ” [CLIENT DEBUG] Initial host status: ${playerNameRef.current} is host: ${currentUser.isHost}`);\r\n              console.log(`ðŸ” [LOBBY DEBUG] Host status update:`, {\r\n        playerName: playerNameRef.current,\r\n        playerId: currentUser.id,\r\n        wasHost: currentIsHost,\r\n        nowHost: currentUser.isHost,\r\n        changed: currentIsHost !== currentUser.isHost\r\n      });\r\n      setCurrentIsHost(currentUser.isHost);\r\n      currentUserIdRef.current = currentUser.id; // Store user ID for session storage\r\n    }\r\n    \r\n    // Auto-update room status based on host location after initial join\r\n    updateRoomStatusBasedOnHost(mappedPlayers);\r\n    \r\n    setIsLoading(false); // Successfully joined, stop loading\r\n    setError(null);\r\n    };\r\n\r\n    const handlePlayerJoined = (data) => {\r\n      console.log('ðŸ‘‹ Player joined:', data.player.name);\r\n      const updatedPlayers = data.players || [];\r\n      setPlayers(updatedPlayers);\r\n      setRoomData(data.room);\r\n      \r\n      // Clear any disconnect countdown for the joined player\r\n      if (data.player?.id) {\r\n        clearDisconnectCountdown(data.player.id);\r\n      }\r\n      \r\n      // Ensure host status is maintained when players join\r\n      const currentUser = updatedPlayers.find(p => p.name === playerNameRef.current);\r\n      if (currentUser) {\r\n        if (currentUser.isHost !== currentIsHost) {\r\n          console.log(`ðŸ” [CLIENT DEBUG] Host status sync: ${playerNameRef.current} is host: ${currentUser.isHost}`);\r\n          setCurrentIsHost(currentUser.isHost);\r\n        }\r\n        // Update user ID if not already set\r\n        if (!currentUserIdRef.current) {\r\n          currentUserIdRef.current = currentUser.id;\r\n        }\r\n      }\r\n      \r\n      // Auto-update room status based on host location\r\n      updateRoomStatusBasedOnHost(updatedPlayers);\r\n    };\r\n\r\n    const handlePlayerStatusUpdated = (data) => {\r\n      console.log('ðŸ”„ Player status updated:', data);\r\n      \r\n      // Map the players using the updated room participants\r\n      const mappedPlayers = data.room?.participants?.map(p => ({\r\n        id: p.user_id,\r\n        name: p.user?.display_name || p.user?.username,\r\n        isHost: p.role === 'host',\r\n        isConnected: p.is_connected,\r\n        inGame: p.in_game,\r\n        currentLocation: p.current_location,\r\n        lastPing: p.last_ping\r\n      })) || [];\r\n      \r\n      setPlayers(mappedPlayers);\r\n      setRoomData(data.room);\r\n      \r\n      // Handle host transfer if included in the update\r\n      if (data.hostTransfer) {\r\n        console.log('ðŸ‘‘ Host transfer detected in status update:', data.hostTransfer);\r\n        \r\n        // Update local host status if current user is affected\r\n        const currentUser = mappedPlayers.find(p => p.name === playerNameRef.current);\r\n        if (currentUser) {\r\n          const newHostStatus = currentUser.isHost;\r\n          console.log(`ðŸ” [CLIENT DEBUG] Host status update via external game: ${playerNameRef.current} is now host: ${newHostStatus}`);\r\n          setCurrentIsHost(newHostStatus);\r\n        }\r\n        \r\n        // Show notification about the host transfer\r\n        const reason = data.hostTransfer.reason === 'external_game_disconnect' ? 'disconnected from game' : \r\n                      data.hostTransfer.reason === 'original_host_left' ? 'left the room' : \r\n                      'disconnected';\r\n        \r\n        console.log(`ðŸ‘‘ [HOST TRANSFER] ${data.hostTransfer.newHostName} is now the host (previous host ${reason})`);\r\n        \r\n        // You could add a toast notification here\r\n        addNotification(`${data.hostTransfer.newHostName} is now the host (previous host ${reason})`, 'info');\r\n      }\r\n      \r\n      // Clear disconnect countdown if player reconnected\r\n      if (data.playerId && data.status === 'connected') {\r\n        clearDisconnectCountdown(data.playerId);\r\n      }\r\n      \r\n      // Auto-update room status based on host location\r\n      updateRoomStatusBasedOnHost(mappedPlayers);\r\n    };\r\n\r\n    const handlePlayerLeft = (data) => {\r\n      console.log('ðŸ‘‹ Player left:', data);\r\n      \r\n      // Update players list with complete status information\r\n      setPlayers(data.players || []);\r\n      \r\n      // Update room data if provided\r\n      if (data.room) {\r\n        setRoomData(data.room);\r\n      }\r\n      \r\n      console.log(`ðŸ‘‹ [LEAVE DEBUG] Updated player list after leave:`, data.players?.map(p => ({\r\n        name: p.name,\r\n        isConnected: p.isConnected,\r\n        currentLocation: p.currentLocation,\r\n        inGame: p.inGame\r\n      })));\r\n    };\r\n\r\n    const handlePlayerDisconnected = (data) => {\r\n      console.log('ðŸ”Œ Player disconnected:', data.playerId);\r\n      \r\n      // If we have updated player list, use it; otherwise update connection status\r\n      if (data.players) {\r\n        setPlayers(data.players);\r\n      } else {\r\n        setPlayers(prev => prev.map(player => \r\n          player.id === data.playerId \r\n            ? { ...player, isConnected: false }\r\n            : player\r\n        ));\r\n      }\r\n      \r\n      // Start countdown timer for the disconnected player\r\n      if (data.playerId) {\r\n        startDisconnectCountdown(data.playerId);\r\n      }\r\n    };\r\n\r\n    const handleGameSelected = (data) => {\r\n      console.log('ðŸŽ® Game selected:', data.gameType);\r\n      setSelectedGame(data.gameType);\r\n    };\r\n\r\n    const handleGameStarted = (data) => {\r\n      console.log('ðŸš€ [LOBBY DEBUG] Game starting event received:', {\r\n        gameUrl: data.gameUrl,\r\n        gameType: data.gameType,\r\n        isHost: data.isHost,\r\n        roomCode: data.roomCode,\r\n        currentPlayerName: playerNameRef.current,\r\n        currentIsHost: currentIsHost,\r\n        socketId: socket?.id,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n      \r\n      // Game integration data is passed via URL parameters only\r\n      console.log('ðŸŽ® [LOBBY DEBUG] Starting game with URL parameters');\r\n      \r\n      console.log('ðŸŽ® [LOBBY DEBUG] Redirecting to game:', data.gameUrl);\r\n      \r\n      // Reset starting state since game is actually starting\r\n      setIsStartingGame(false);\r\n      \r\n      // Properly disconnect socket before navigation to prevent WebSocket errors\r\n      if (socket) {\r\n        console.log('ðŸ”Œ [LOBBY DEBUG] Disconnecting socket before game redirect...');\r\n        socket.disconnect();\r\n      }\r\n      \r\n      // Small delay to ensure disconnect completes before navigation\r\n      setTimeout(() => {\r\n        // Redirect to game\r\n        window.location.href = data.gameUrl;\r\n      }, 100);\r\n    };\r\n\r\n    const handleError = (error) => {\r\n      console.error('âŒ [LOBBY DEBUG] Socket error received:', {\r\n        error: error.message || error,\r\n        code: error.code,\r\n        debug: error.debug,\r\n        roomCode: roomCodeRef.current,\r\n        playerName: playerNameRef.current,\r\n        timestamp: new Date().toISOString(),\r\n        // connectionStatus, // This local state is removed\r\n        isLoading,\r\n        currentError: error // Renamed from 'error' to avoid conflict\r\n      });\r\n      \r\n      // Enhanced error handling based on error code\r\n      let userFriendlyMessage = error.message || 'An error occurred';\r\n      let shouldRedirect = false; // Flag for critical errors that require leaving\r\n      \r\n      switch (error.code) {\r\n        case 'ROOM_NOT_FOUND':\r\n          userFriendlyMessage = 'Room not found. It may have expired or been cleaned up.';\r\n          shouldRedirect = true; // Critical error - room doesn't exist\r\n          console.error('ðŸ” [LOBBY DEBUG] Room not found details:', {\r\n            roomCode: roomCodeRef.current,\r\n            searchedFor: error.debug?.room_code,\r\n            timestamp: error.debug?.search_timestamp\r\n          });\r\n          break;\r\n        case 'ROOM_FULL':\r\n          userFriendlyMessage = 'Room is full. Cannot rejoin at this time.';\r\n          shouldRedirect = true; // Critical error - can't join\r\n          break;\r\n        case 'ROOM_NOT_ACCEPTING':\r\n          userFriendlyMessage = `Room is ${error.debug?.room_status || 'not accepting players'}.`;\r\n          // Don't redirect - show popup and let user stay in lobby\r\n          console.error('ðŸ” [LOBBY DEBUG] Room not accepting details:', {\r\n            roomStatus: error.debug?.room_status,\r\n            isOriginalCreator: error.debug?.is_original_creator\r\n          });\r\n          break;\r\n        case 'DUPLICATE_PLAYER':\r\n          userFriendlyMessage = 'Player name already in use. Try a different name.';\r\n          shouldRedirect = true; // Critical error - name conflict\r\n          break;\r\n        case 'JOIN_FAILED':\r\n          userFriendlyMessage = 'Failed to join room. Please try refreshing the page.';\r\n          // Don't redirect - let user try actions in lobby\r\n          break;\r\n        case 'KICK_FAILED':\r\n          userFriendlyMessage = error.message || 'Failed to kick player. You may not have permission.';\r\n          // Don't redirect - just show error popup\r\n          break;\r\n        case 'NOT_HOST':\r\n          userFriendlyMessage = 'Only the host can perform this action.';\r\n          // Don't redirect - just show error popup\r\n          break;\r\n        default:\r\n          console.error('ðŸ” [LOBBY DEBUG] Unknown error code:', error.code);\r\n          // For unknown errors, show popup but don't redirect\r\n      }\r\n      \r\n      // For critical errors, use the error state that redirects\r\n      if (shouldRedirect) {\r\n        setError(userFriendlyMessage);\r\n        setIsLoading(false);\r\n      } else {\r\n        // For non-critical errors, show popup and stay in lobby\r\n        // alert(`âš ï¸ ${userFriendlyMessage}`);\r\n        addNotification(userFriendlyMessage, 'warning');\r\n        \r\n        // If we were loading, stop the loading state\r\n        if (isLoading) {\r\n          setIsLoading(false);\r\n        }\r\n      }\r\n    };\r\n\r\n    const handleHostTransferred = (data) => {\r\n      console.log('ðŸ‘‘ Host transferred:', data);\r\n      \r\n      // Update players list with complete status information\r\n      const updatedPlayers = data.players || [];\r\n      setPlayers(updatedPlayers);\r\n      \r\n      // Update room data if provided\r\n      if (data.room) {\r\n        setRoomData(data.room);\r\n      }\r\n      \r\n      // Update local host status - check if current user is the new host\r\n      const currentUser = updatedPlayers.find(p => p.name === playerNameRef.current);\r\n      if (currentUser) {\r\n        const newHostStatus = currentUser.isHost;\r\n        console.log(`ðŸ” [CLIENT DEBUG] Host status update: ${playerNameRef.current} is now host: ${newHostStatus}`);\r\n        setCurrentIsHost(newHostStatus);\r\n      }\r\n      \r\n      console.log(`ðŸ‘‘ [HOST DEBUG] Updated player list after host transfer:`, updatedPlayers.map(p => ({\r\n        name: p.name,\r\n        isHost: p.isHost,\r\n        isConnected: p.isConnected,\r\n        currentLocation: p.currentLocation,\r\n        inGame: p.inGame\r\n      })));\r\n      \r\n      // Show notification\r\n      const reasonText = data.reason === 'original_host_left' ? 'left the room' :\r\n                    data.reason === 'original_host_disconnected' ? 'disconnected' : 'transferred host';\r\n      \r\n      addNotification(`${data.newHostName} is now the host (previous host ${reasonText}).`, 'info');\r\n      \r\n      // Auto-update room status based on new host location\r\n      updateRoomStatusBasedOnHost(updatedPlayers);\r\n    };\r\n\r\n    const handleRoomStatusChanged = (data) => {\r\n      console.log('ðŸ”„ Room status changed:', data);\r\n      \r\n      // Update room status\r\n      setRoomStatus(data.newStatus);\r\n      setRoomData(data.room);\r\n      \r\n      // If status changed back to waiting_for_players, reset selected game\r\n      if (data.newStatus === 'waiting_for_players') {\r\n        setSelectedGame(null);\r\n      }\r\n      \r\n      // Show notification (you could implement a toast system here)\r\n      addNotification(`Room status changed to '${data.newStatus}' by ${data.changedBy}.`, 'info');\r\n    };\r\n\r\n    const handlePlayerKicked = (data) => {\r\n      console.log('ðŸ‘¢ [KICK DEBUG] Player kicked event received:', {\r\n        data,\r\n        isNotification: data.isNotification,\r\n        targetUserId: data.targetUserId,\r\n        reason: data.reason,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n\r\n      if (data.isNotification) {\r\n        // This is a notification to other players about someone being kicked\r\n        console.log(`ðŸ‘¢ [KICK DEBUG] ${data.targetName} was kicked by ${data.kickedBy}`);\r\n        \r\n        // Update players list with complete status information\r\n        setPlayers(data.players || []);\r\n        \r\n        // Update room data if provided\r\n        if (data.room) {\r\n          setRoomData(data.room);\r\n        }\r\n        \r\n        console.log(`ðŸ‘¢ [KICK DEBUG] Updated player list after kick:`, data.players?.map(p => ({\r\n          name: p.name,\r\n          isConnected: p.isConnected,\r\n          currentLocation: p.currentLocation,\r\n          inGame: p.inGame\r\n        })));\r\n        \r\n        addNotification(`${data.targetName} was removed from the room by ${data.kickedBy}.`, 'warning');\r\n      } else {\r\n        // This player was kicked personally\r\n        console.log('ðŸ‘¢ [KICK DEBUG] You have been kicked from the room:', {\r\n          reason: data.reason,\r\n          kickedBy: data.kickedBy,\r\n          roomCode: data.roomCode\r\n        });\r\n        \r\n        addNotification(`You have been kicked: ${data.reason} (by ${data.kickedBy})`, 'error');\r\n\r\n        // Clear socket and leave room\r\n        if (socket) {\r\n          socket.disconnect(); // This should trigger SocketProvider's cleanup for this instance\r\n        }\r\n\r\n        // Redirect to homepage\r\n        if (onLeave) {\r\n          onLeave();\r\n        }\r\n      }\r\n    };\r\n\r\n    const handleKickFailed = (data) => {\r\n      console.log('ðŸ‘¢ [KICK DEBUG] Kick failed event received:', {\r\n        data,\r\n        error: data.error,\r\n        reason: data.reason,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n\r\n      addNotification(`Failed to kick player: ${data.reason || data.error || 'Unknown error'}`, 'error');\r\n    };\r\n\r\n    // Add event listeners\r\n    // socket.on('connect', handleConnect); // This is implicitly handled by SocketProvider or initial join\r\n    // socket.on('disconnect', handleDisconnect); // SocketProvider handles global disconnect\r\n    // socket.on('connect_error', handleConnectError); // SocketProvider handles global connect_error\r\n\r\n    socket.on('roomJoined', handleRoomJoined);\r\n    socket.on('playerJoined', handlePlayerJoined);\r\n    socket.on('playerLeft', handlePlayerLeft);\r\n    socket.on('playerDisconnected', handlePlayerDisconnected);\r\n    socket.on('playerStatusUpdated', handlePlayerStatusUpdated);\r\n    socket.on('gameSelected', handleGameSelected);\r\n    socket.on('gameStarted', handleGameStarted);\r\n    socket.on('hostTransferred', handleHostTransferred);\r\n    socket.on('roomStatusChanged', handleRoomStatusChanged);\r\n    socket.on('playerKicked', handlePlayerKicked);\r\n    socket.on('kickFailed', handleKickFailed);\r\n    socket.on('error', handleError);\r\n\r\n    // Cleanup function\r\n    return () => {\r\n      console.log('ðŸ§¹ [RoomLobby] Cleaning up socket event listeners for RoomLobby instance.');\r\n      \r\n      // Clear all disconnect timers\r\n      timerIntervalsRef.current.forEach(intervalId => {\r\n        clearInterval(intervalId);\r\n      });\r\n      timerIntervalsRef.current.clear();\r\n      setDisconnectedTimers(new Map());\r\n      \r\n      if (socket) {\r\n        // Remove event listeners\r\n        // socket.off('connect', handleConnect);\r\n        // socket.off('disconnect', handleDisconnect);\r\n        // socket.off('connect_error', handleConnectError);\r\n        socket.off('roomJoined', handleRoomJoined);\r\n        socket.off('playerJoined', handlePlayerJoined);\r\n        socket.off('playerLeft', handlePlayerLeft);\r\n        socket.off('playerDisconnected', handlePlayerDisconnected);\r\n        socket.off('playerStatusUpdated', handlePlayerStatusUpdated);\r\n        socket.off('gameSelected', handleGameSelected);\r\n        socket.off('gameStarted', handleGameStarted);\r\n        socket.off('hostTransferred', handleHostTransferred);\r\n        socket.off('roomStatusChanged', handleRoomStatusChanged);\r\n        socket.off('playerKicked', handlePlayerKicked);\r\n        socket.off('kickFailed', handleKickFailed);\r\n        socket.off('error', handleError);\r\n        \r\n        // Emit leaveRoom only if the socket is still connected\r\n        // The main disconnect is handled by SocketProvider when App unmounts\r\n        if (socket.connected) {\r\n          const currentRoomCode = roomCodeRef.current;\r\n          if (currentRoomCode) {\r\n            console.log('ðŸ“¤ [RoomLobby] Emitting leaveRoom on unmount/cleanup for room:', currentRoomCode);\r\n            socket.emit('leaveRoom', { roomCode: currentRoomCode });\r\n          }\r\n        }\r\n      }\r\n    };\r\n  }, [socket, socketIsConnected]); // Effect dependencies: socket instance and its connection status\r\n\r\n  // Add beforeunload handler to cleanup WebSocket on navigation\r\n  useEffect(() => {\r\n    const handleBeforeUnload = () => {\r\n      if (socket && socket.connected) {\r\n        console.log('ðŸ”Œ [LOBBY DEBUG] Cleaning up socket before page unload...');\r\n        socket.disconnect();\r\n      }\r\n    };\r\n\r\n    window.addEventListener('beforeunload', handleBeforeUnload);\r\n    \r\n    return () => {\r\n      window.removeEventListener('beforeunload', handleBeforeUnload);\r\n    };\r\n  }, [socket]);\r\n\r\n  const handleGameSelect = (gameType) => {\r\n    if (socket && socketIsConnected && currentIsHost) {\r\n      console.log('ðŸŽ® Selecting game:', gameType);\r\n      socket.emit('selectGame', { gameType });\r\n    }\r\n  };\r\n\r\n  const handleStartGame = () => {\r\n    // Prevent multiple rapid clicks\r\n    if (isStartingGame) {\r\n      console.log('ðŸš€ [START GAME DEBUG] Game start already in progress, ignoring click');\r\n      return;\r\n    }\r\n    \r\n    if (socket && socketIsConnected && currentIsHost) {\r\n      console.log('ðŸš€ [START GAME DEBUG] Starting game:', {\r\n        socketConnected: socket.connected, // socketIsConnected from context\r\n        socketId: socket.id, // socketId from context\r\n        roomCode: roomCodeRef.current,\r\n        playerName: playerNameRef.current,\r\n        isHost: currentIsHost,\r\n        // connectionStatus, // Removed\r\n        isStartingGame,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n      \r\n      // Redundant check, socketIsConnected should cover this\r\n      // if (!socket.connected) {\r\n      //   console.error('âŒ [START GAME DEBUG] Socket not connected, cannot start game');\r\n      //   addNotification('Connection lost. Please refresh the page and try again.', 'error');\r\n      //   return;\r\n      // }\r\n      \r\n      setIsStartingGame(true);\r\n      addNotification('Starting game...', 'info');\r\n      console.log('ðŸ“¤ [START GAME DEBUG] Emitting startGame event');\r\n      socket.emit('startGame', { roomCode: roomCodeRef.current });\r\n      \r\n      // Reset after a delay to allow for game start\r\n      setTimeout(() => {\r\n        setIsStartingGame(false);\r\n      }, 5000);\r\n      \r\n    } else {\r\n      console.error('âŒ [START GAME DEBUG] Cannot start game:', {\r\n        hasSocket: !!socket,\r\n        isHost: currentIsHost,\r\n        socketConnected: socketIsConnected,\r\n        // connectionStatus, // Removed\r\n        isStartingGame\r\n      });\r\n      \r\n      if (!currentIsHost) {\r\n        addNotification('Only the host can start the game.', 'warning');\r\n      } else if (!socket || !socketIsConnected) {\r\n        addNotification('Connection lost. Please refresh the page and try again.', 'error');\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleLeaveRoom = () => {\r\n    if (socket && socketIsConnected) {\r\n      socket.emit('leaveRoom', { roomCode: roomCodeRef.current });\r\n    }\r\n    if (onLeave) {\r\n      onLeave();\r\n    }\r\n  };\r\n\r\n  const handleTransferHost = (targetPlayerId) => {\r\n    if (socket && socketIsConnected && currentIsHost) {\r\n      console.log('ðŸ‘‘ Transferring host to player:', targetPlayerId);\r\n      socket.emit('transferHost', { \r\n        roomCode: roomCodeRef.current,\r\n        targetUserId: targetPlayerId\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleKickPlayer = (targetPlayerId, targetPlayerName) => {\r\n    if (socket && socketIsConnected && currentIsHost) {\r\n      // Confirm kick action\r\n      const confirmed = window.confirm(\r\n        `Are you sure you want to kick ${targetPlayerName} from the room?`\r\n      );\r\n      \r\n      if (confirmed) {\r\n        console.log('ðŸ‘¢ [KICK DEBUG] Kicking player:', {\r\n          targetPlayerId,\r\n          targetPlayerName,\r\n          roomCode: roomCodeRef.current,\r\n          timestamp: new Date().toISOString()\r\n        });\r\n        \r\n        socket.emit('kickPlayer', {\r\n          roomCode: roomCodeRef.current,\r\n          targetUserId: targetPlayerId\r\n        });\r\n      } else {\r\n        console.log('ðŸ‘¢ [KICK DEBUG] Kick cancelled by host');\r\n      }\r\n    }\r\n  };\r\n\r\n\r\n\r\n  const handleReturnToLobby = () => {\r\n    if (socket && socketIsConnected) {\r\n      console.log('ðŸ”„ Player returning to lobby');\r\n      socket.emit('playerReturnToLobby', {\r\n        roomCode: roomCodeRef.current,\r\n        playerName: playerNameRef.current\r\n      });\r\n      \r\n      // If current user is host, automatically update room status to lobby\r\n      if (currentIsHost) {\r\n        console.log('ðŸ”„ Host returning to lobby - auto-updating room status');\r\n        // The status will be updated when we receive the playerStatusUpdated event\r\n        // but we can also trigger it immediately for responsiveness\r\n        setTimeout(() => {\r\n          // Re-fetch current player status and update room status\r\n          const currentPlayer = players.find(p => p.name === playerNameRef.current);\r\n          if (currentPlayer) {\r\n            const updatedPlayers = players.map(p => \r\n              p.name === playerNameRef.current \r\n                ? { ...p, inGame: false, currentLocation: 'lobby' }\r\n                : p\r\n            );\r\n            updateRoomStatusBasedOnHost(updatedPlayers);\r\n          }\r\n        }, 100);\r\n      }\r\n    }\r\n  };\r\n\r\n  // Automatic status management based on host location\r\n  const updateRoomStatusBasedOnHost = (updatedPlayers) => {\r\n    if (!currentIsHost || !socket || !socketIsConnected) return;\r\n    \r\n    const currentHost = updatedPlayers.find(p => p.isHost);\r\n    if (!currentHost) return;\r\n    \r\n    let targetStatus = 'waiting_for_players';\r\n    \r\n    // Determine status based on host location\r\n    if (currentHost.currentLocation === 'game' || currentHost.inGame) {\r\n      targetStatus = 'in_game';\r\n    } else if (currentHost.currentLocation === 'lobby' || (!currentHost.inGame && currentHost.isConnected)) {\r\n      targetStatus = 'waiting_for_players';\r\n    }\r\n    \r\n    // Only update if status needs to change\r\n    if (targetStatus !== roomStatus) {\r\n      console.log('ðŸ”„ Auto-updating room status based on host location:', {\r\n        hostLocation: currentHost.currentLocation,\r\n        hostInGame: currentHost.inGame,\r\n        currentStatus: roomStatus,\r\n        newStatus: targetStatus\r\n      });\r\n      \r\n      // Update room status automatically\r\n      socket.emit('autoUpdateRoomStatus', {\r\n        roomCode: roomCodeRef.current,\r\n        newStatus: targetStatus,\r\n        reason: 'host_location_change'\r\n      });\r\n    }\r\n  };\r\n\r\n  // Helper function to get player status\r\n  const getPlayerStatus = (player) => {\r\n    console.log(`ðŸ” [STATUS DEBUG] Getting status for ${player.name}:`, {\r\n      currentLocation: player.currentLocation,\r\n      isConnected: player.isConnected,\r\n      inGame: player.inGame,\r\n      lastPing: player.lastPing\r\n    });\r\n\r\n    // Use currentLocation if available, otherwise fall back to old logic\r\n    if (player.currentLocation) {\r\n      switch (player.currentLocation) {\r\n        case 'game':\r\n          return { status: 'in_game', label: 'In Game', color: '#ff6b35', icon: 'ðŸŽ®' };\r\n        case 'lobby':\r\n          return { status: 'lobby', label: 'In Lobby', color: '#4caf50', icon: 'ðŸŸ¢' };\r\n        case 'disconnected':\r\n          return { status: 'disconnected', label: 'Offline', color: '#666', icon: 'âš«' };\r\n        default:\r\n          console.warn(`ðŸ” [STATUS DEBUG] Unknown currentLocation: ${player.currentLocation}, falling back to lobby`);\r\n          return { status: 'lobby', label: 'In Lobby', color: '#4caf50', icon: 'ðŸŸ¢' };\r\n      }\r\n    }\r\n    \r\n    // Fallback to old logic for backward compatibility\r\n    console.log(`ðŸ” [STATUS DEBUG] No currentLocation for ${player.name}, using fallback logic`);\r\n    if (!player.isConnected) {\r\n      return { status: 'disconnected', label: 'Offline', color: '#666', icon: 'âš«' };\r\n    }\r\n    if (player.inGame) {\r\n      return { status: 'in_game', label: 'In Game', color: '#ff6b35', icon: 'ðŸŽ®' };\r\n    }\r\n    return { status: 'lobby', label: 'In Lobby', color: '#4caf50', icon: 'ðŸŸ¢' };\r\n  };\r\n\r\n  // Loading state\r\n  if (isLoading || !socketIsConnected) { // Also show loading if socket is not connected yet\r\n    return (\r\n      <div className=\"room-lobby\">\r\n        <div className=\"lobby-header\">\r\n          <h2>Room {roomCode}</h2>\r\n          <div className=\"connection-status\">\r\n            Status: {socketIsConnected ? 'Connected' : 'Connecting...'} {/* Use socketIsConnected */}\r\n          </div>\r\n        </div>\r\n        <div className=\"loading-container\">\r\n          <div className=\"loading-spinner\"></div>\r\n          <p>{socketIsConnected ? 'Joining room...' : 'Connecting to server...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Error state\r\n  if (error) {\r\n    return (\r\n      <div className=\"room-lobby\">\r\n        <div className=\"lobby-header\">\r\n          <h2>Room {roomCode}</h2>\r\n        </div>\r\n        <div className=\"error-container\">\r\n          <div className=\"error-message\">\r\n            <h3>Connection Error</h3>\r\n            <p>{error}</p>\r\n            <div className=\"error-actions\">\r\n              {/* Removed retry button as connection is managed by SocketProvider now */}\r\n              {/* <button onClick={() => window.location.reload()} className=\"retry-button\">\r\n                Retry Connection\r\n              </button> */}\r\n              <button onClick={handleLeaveRoom} className=\"leave-button\">\r\n                Leave Room\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"room-lobby\">\r\n      <div className=\"lobby-header\">\r\n        <button onClick={handleLeaveRoom} className=\"leave-button\">\r\n          Leave Room\r\n        </button>\r\n        \r\n        <div className=\"room-info-header\">\r\n          <div className=\"room-code-display\">{roomCode}</div>\r\n          <div className=\"room-status-section\">\r\n            <div className=\"room-status-display\">\r\n              <span className=\"status-label\">Status:</span>\r\n              <span className={`status-badge status-${roomStatus}`}>\r\n                {roomStatus.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div className=\"room-actions\">\r\n            <button className=\"copy-btn\" onClick={() => navigator.clipboard.writeText(roomCode)}>\r\n              ðŸ“‹ Copy Code\r\n            </button>\r\n            <button \r\n              className=\"copy-link-btn\" \r\n              onClick={() => {\r\n                const roomUrl = `${window.location.origin}/?join=${roomCode}`;\r\n                navigator.clipboard.writeText(roomUrl);\r\n              }}\r\n            >\r\n              ðŸ”— Copy Link\r\n            </button>\r\n          </div>\r\n        </div>\r\n        \r\n        <div style={{ width: '120px' }}></div> {/* Spacer for layout balance */}\r\n      </div>\r\n\r\n      <div className=\"lobby-content\">\r\n        {/* Room Status Information */}\r\n        {!currentIsHost && roomStatus !== 'waiting_for_players' && (\r\n          <div className=\"status-info-section\">\r\n            <div className=\"status-info-card\">\r\n              <div className=\"status-info-icon\">\r\n                {roomStatus === 'active' && 'ðŸ”µ'}\r\n                {roomStatus === 'paused' && 'ðŸŸ¡'}\r\n                {roomStatus === 'finished' && 'ðŸ”´'}\r\n                {roomStatus === 'abandoned' && 'âš«'}\r\n                {roomStatus === 'launching' && 'ï¿½ï¿½'}\r\n              </div>\r\n              <div className=\"status-info-content\">\r\n                <h4 className=\"status-info-title\">\r\n                  Room is {roomStatus.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}\r\n                </h4>\r\n                <p className=\"status-info-description\">\r\n                  {roomStatus === 'active' && 'The room is currently active. New players cannot join right now.'}\r\n                  {roomStatus === 'paused' && 'The room is paused. The host can resume or change the status.'}\r\n                  {roomStatus === 'finished' && 'This room has finished. The host can reopen it for new players.'}\r\n                  {roomStatus === 'abandoned' && 'This room has been abandoned. The host can reactivate it.'}\r\n                  {roomStatus === 'launching' && 'The room is launching. Please wait for the game to start.'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"players-section\">\r\n          <div className=\"section-header\">\r\n            <h3 className=\"section-title\">Players in Room</h3>\r\n            {/* Show return to lobby button if current player is in game */}\r\n            {players.find(p => p.name === playerNameRef.current)?.inGame && (\r\n              <button \r\n                className=\"return-to-lobby-btn\"\r\n                onClick={handleReturnToLobby}\r\n                title=\"Mark yourself as returned to lobby\"\r\n              >\r\n                ðŸ”„ Return to Lobby\r\n              </button>\r\n            )}\r\n          </div>\r\n          <div className=\"players-grid\">\r\n            {players\r\n              .filter(player => {\r\n                // Show connected players\r\n                if (player.isConnected) return true;\r\n                \r\n                // Show disconnected players only if they still have a countdown timer\r\n                if (!player.isConnected && disconnectedTimers.has(player.id)) {\r\n                  return true;\r\n                }\r\n                \r\n                // Hide disconnected players after countdown expires\r\n                return false;\r\n              })\r\n              .map((player) => {\r\n                const playerStatus = getPlayerStatus(player);\r\n                const countdownTime = disconnectedTimers.get(player.id);\r\n                const isDisconnectedWithTimer = !player.isConnected && countdownTime > 0;\r\n                \r\n                return (\r\n                  <div \r\n                    key={player.id} \r\n                    className={`player-card ${player.isHost ? 'host' : ''} ${playerStatus.status} ${isDisconnectedWithTimer ? 'disconnecting' : ''}`}\r\n                  >\r\n                    <div className=\"player-card-content\">\r\n                      <div className=\"player-avatar\">\r\n                        {player.name.charAt(0).toUpperCase()}\r\n                      </div>\r\n                      <div className=\"player-info\">\r\n                        <span className=\"player-name\">{player.name}</span>\r\n                        <div className=\"player-badges\">\r\n                          {player.isHost && <span className=\"host-badge\">Host</span>}\r\n                          <span \r\n                            className=\"status-badge\"\r\n                            style={{ backgroundColor: playerStatus.color }}\r\n                            title={`${player.name} is ${playerStatus.label.toLowerCase()}`}\r\n                          >\r\n                            {playerStatus.icon} {playerStatus.label}\r\n                          </span>\r\n                          {/* Show countdown timer for disconnected players */}\r\n                          {isDisconnectedWithTimer && (\r\n                            <span className=\"countdown-badge\" title=\"Time until removed from room\">\r\n                              â±ï¸ {countdownTime}s\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    {/* Show host controls if current user is host and this is not the host */}\r\n                    {currentIsHost && !player.isHost && !isDisconnectedWithTimer && (\r\n                      <div className=\"player-actions\">\r\n                        <button \r\n                          className=\"make-host-btn\"\r\n                          onClick={() => handleTransferHost(player.id)}\r\n                          title={`Make ${player.name} the host`}\r\n                        >\r\n                          ðŸ‘‘ Make Host\r\n                        </button>\r\n                        <button \r\n                          className=\"kick-player-btn\"\r\n                          onClick={() => handleKickPlayer(player.id, player.name)}\r\n                          title={`Kick ${player.name} from the room`}\r\n                        >\r\n                          ðŸ‘¢ Kick\r\n                        </button>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              })}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"game-section\">\r\n          <h3 className=\"section-title\">Game Selection</h3>\r\n          {!selectedGame ? (\r\n            <GamePicker \r\n              onGameSelect={handleGameSelect}\r\n              isHost={currentIsHost}\r\n              disabled={!socket || !socketIsConnected} // Use socketIsConnected\r\n            />\r\n          ) : (\r\n            <div className=\"selected-game-card\">\r\n              <div className=\"game-icon\">\r\n                {selectedGame === 'ddf' ? 'ðŸŽ®' : selectedGame === 'schooled' ? 'ðŸŽ“' : selectedGame === 'susd' ? 'ðŸ”' : 'ðŸŽ®'}\r\n              </div>\r\n              <div className=\"game-details\">\r\n                <h4>{selectedGame === 'ddf' ? 'Der dÃ¼mmste fliegt' : selectedGame === 'schooled' ? 'School Quiz' : selectedGame === 'susd' ? 'SUS\\'D' : selectedGame}</h4>\r\n                <p>{selectedGame === 'ddf' ? 'Quiz game where the worst player gets eliminated' : selectedGame === 'schooled' ? 'Educational quiz game for students' : selectedGame === 'susd' ? 'Imposter game - find who\\'s acting suspicious!' : 'Unknown game'}</p>\r\n                <span className=\"max-players\">Max {selectedGame === 'ddf' ? '8' : selectedGame === 'schooled' ? '10' : selectedGame === 'susd' ? '10' : '8'} players</span>\r\n              </div>\r\n              {currentIsHost && (\r\n                <div>\r\n                  <button \r\n                    onClick={handleStartGame}\r\n                    className=\"start-game-button\"\r\n                    disabled={!socket || !socketIsConnected || isStartingGame} // Use socketIsConnected\r\n                  >\r\n                    {isStartingGame ? 'Starting Game...' : 'Start Game'}\r\n                  </button>\r\n                  <button \r\n                    onClick={() => {\r\n                      setSelectedGame(null);\r\n                      if (socket && socketIsConnected) { // Also emit game deselection if needed\r\n                        socket.emit('selectGame', { gameType: null }); // Assuming server handles null as deselection\r\n                      }\r\n                    }}\r\n                    className=\"change-game-btn\"\r\n                    disabled={!socket || !socketIsConnected} // Use socketIsConnected\r\n                    style={{ marginTop: '1rem' }}\r\n                  >\r\n                    Change Game\r\n                  </button>\r\n                </div>\r\n              )}\r\n              {!currentIsHost && (\r\n                <div style={{ textAlign: 'center' }}>\r\n                  <p>Waiting for host to start the game...</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {roomData && (\r\n        <div className=\"room-details\">\r\n          <small>\r\n            Room created: {new Date(roomData.created_at).toLocaleString()}\r\n            {roomData.metadata?.created_by_name && (\r\n              <> by {roomData.metadata.created_by_name}</>\r\n            )}\r\n          </small>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RoomLobby; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
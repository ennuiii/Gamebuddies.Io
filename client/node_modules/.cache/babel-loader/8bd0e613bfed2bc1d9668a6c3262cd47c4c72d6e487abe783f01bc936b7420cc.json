{"ast":null,"code":"import React,{createContext,useContext,useEffect,useState,useRef,useCallback}from'react';import io from'socket.io-client';import{jsx as _jsx}from\"react/jsx-runtime\";const SocketContext=/*#__PURE__*/createContext();export const useSocket=()=>{return useContext(SocketContext);};export const LazySocketProvider=_ref=>{let{children}=_ref;const[socket,setSocket]=useState(null);const[socketId,setSocketId]=useState(null);const[isConnected,setIsConnected]=useState(false);const[isConnecting,setIsConnecting]=useState(false);const reconnectionTimeoutRef=useRef(null);const reconnectionAttemptsRef=useRef(0);const maxReconnectionAttempts=3;const socketRef=useRef(null);// Determine server URL based on environment\nconst getServerUrl=useCallback(()=>{if(process.env.REACT_APP_SERVER_URL){return process.env.REACT_APP_SERVER_URL;}if(window.location.hostname==='gamebuddies.io'||window.location.hostname.includes('gamebuddies-client')){return window.location.origin;}if(window.location.hostname.includes('onrender.com')){return window.location.origin;}if(window.location.hostname!=='localhost'&&window.location.hostname!=='127.0.0.1'){return window.location.origin;}// Default for local development if no other conditions met\nreturn'https://gamebuddies.io';},[]);const attemptReconnection=useCallback(()=>{if(reconnectionAttemptsRef.current>=maxReconnectionAttempts){console.log('âŒ [LazySocketProvider] Max reconnection attempts reached. Stopping reconnection.');setIsConnecting(false);return;}reconnectionAttemptsRef.current++;const delay=Math.pow(2,reconnectionAttemptsRef.current)*1000;// Exponential backoff\nconsole.log(\"\\uD83D\\uDD04 [LazySocketProvider] Reconnection attempt \".concat(reconnectionAttemptsRef.current,\"/\").concat(maxReconnectionAttempts,\" in \").concat(delay,\"ms\"));reconnectionTimeoutRef.current=setTimeout(()=>{if(socketRef.current&&!socketRef.current.connected&&!isConnected){console.log('ðŸ”Œ [LazySocketProvider] Attempting reconnection...');socketRef.current.connect();}},delay);},[isConnected,maxReconnectionAttempts]);const connectSocket=useCallback(()=>{var _socketRef$current;// Don't create connection if already connecting or connected\nif(isConnecting||(_socketRef$current=socketRef.current)!==null&&_socketRef$current!==void 0&&_socketRef$current.connected){return socketRef.current;}const serverUrl=getServerUrl();console.log('ðŸ”Œ [LazySocketProvider] Connecting to server:',serverUrl);setIsConnecting(true);const newSocket=io(serverUrl,{transports:['websocket','polling'],timeout:20000,// 20 seconds\nreconnection:false,// Disable automatic reconnection\nforceNew:false,// Don't force new connections\nautoConnect:false// Don't auto-connect\n});newSocket.on('connect',()=>{console.log('âœ… [LazySocketProvider] Connected to server. Socket ID:',newSocket.id);setSocket(newSocket);setSocketId(newSocket.id);setIsConnected(true);setIsConnecting(false);reconnectionAttemptsRef.current=0;// Reset reconnection attempts on successful connection\n// Clear any pending reconnection timeout\nif(reconnectionTimeoutRef.current){clearTimeout(reconnectionTimeoutRef.current);reconnectionTimeoutRef.current=null;}});newSocket.on('disconnect',reason=>{console.log('âŒ [LazySocketProvider] Disconnected from server. Reason:',reason);setIsConnected(false);setIsConnecting(false);// Only attempt reconnection for certain disconnect reasons\nif(reason==='io server disconnect'){console.log('ðŸ”„ [LazySocketProvider] Server initiated disconnect, attempting reconnection...');attemptReconnection();}else if(reason==='transport close'||reason==='transport error'){console.log('ðŸ”„ [LazySocketProvider] Transport issue, attempting reconnection...');attemptReconnection();}});newSocket.on('connect_error',error=>{console.error('âŒ [LazySocketProvider] Connection error:',error);setIsConnected(false);setIsConnecting(false);// Attempt reconnection with backoff\nattemptReconnection();});socketRef.current=newSocket;// Connect the socket\nnewSocket.connect();return newSocket;},[getServerUrl,isConnecting,isConnected,attemptReconnection]);const disconnectSocket=useCallback(()=>{if(socketRef.current){console.log('ðŸ§¹ [LazySocketProvider] Disconnecting socket');// Clear any pending reconnection timeout\nif(reconnectionTimeoutRef.current){clearTimeout(reconnectionTimeoutRef.current);reconnectionTimeoutRef.current=null;}socketRef.current.disconnect();socketRef.current=null;setSocket(null);setSocketId(null);setIsConnected(false);setIsConnecting(false);reconnectionAttemptsRef.current=0;}},[]);// Cleanup on component unmount\nuseEffect(()=>{return()=>{console.log('ðŸ§¹ [LazySocketProvider] Component unmounting, cleaning up...');disconnectSocket();};},[disconnectSocket]);const value={socket,socketId,isConnected,isConnecting,connectSocket,disconnectSocket};return/*#__PURE__*/_jsx(SocketContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useRef","useCallback","io","jsx","_jsx","SocketContext","useSocket","LazySocketProvider","_ref","children","socket","setSocket","socketId","setSocketId","isConnected","setIsConnected","isConnecting","setIsConnecting","reconnectionTimeoutRef","reconnectionAttemptsRef","maxReconnectionAttempts","socketRef","getServerUrl","process","env","REACT_APP_SERVER_URL","window","location","hostname","includes","origin","attemptReconnection","current","console","log","delay","Math","pow","concat","setTimeout","connected","connect","connectSocket","_socketRef$current","serverUrl","newSocket","transports","timeout","reconnection","forceNew","autoConnect","on","id","clearTimeout","reason","error","disconnectSocket","disconnect","value","Provider"],"sources":["C:/Gamebuddies2/gamebuddies/Gamebuddies.Io/client/src/contexts/LazySocketContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState, useRef, useCallback } from 'react';\r\nimport io from 'socket.io-client';\r\n\r\nconst SocketContext = createContext();\r\n\r\nexport const useSocket = () => {\r\n  return useContext(SocketContext);\r\n};\r\n\r\nexport const LazySocketProvider = ({ children }) => {\r\n  const [socket, setSocket] = useState(null);\r\n  const [socketId, setSocketId] = useState(null);\r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const [isConnecting, setIsConnecting] = useState(false);\r\n  const reconnectionTimeoutRef = useRef(null);\r\n  const reconnectionAttemptsRef = useRef(0);\r\n  const maxReconnectionAttempts = 3;\r\n  const socketRef = useRef(null);\r\n\r\n  // Determine server URL based on environment\r\n  const getServerUrl = useCallback(() => {\r\n    if (process.env.REACT_APP_SERVER_URL) {\r\n      return process.env.REACT_APP_SERVER_URL;\r\n    }\r\n    if (window.location.hostname === 'gamebuddies.io' || window.location.hostname.includes('gamebuddies-client')) {\r\n      return window.location.origin;\r\n    }\r\n    if (window.location.hostname.includes('onrender.com')) {\r\n      return window.location.origin;\r\n    }\r\n    if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {\r\n      return window.location.origin;\r\n    }\r\n    // Default for local development if no other conditions met\r\n    return 'https://gamebuddies.io';\r\n  }, []);\r\n\r\n  const attemptReconnection = useCallback(() => {\r\n    if (reconnectionAttemptsRef.current >= maxReconnectionAttempts) {\r\n      console.log('âŒ [LazySocketProvider] Max reconnection attempts reached. Stopping reconnection.');\r\n      setIsConnecting(false);\r\n      return;\r\n    }\r\n    \r\n    reconnectionAttemptsRef.current++;\r\n    const delay = Math.pow(2, reconnectionAttemptsRef.current) * 1000; // Exponential backoff\r\n    console.log(`ðŸ”„ [LazySocketProvider] Reconnection attempt ${reconnectionAttemptsRef.current}/${maxReconnectionAttempts} in ${delay}ms`);\r\n    \r\n    reconnectionTimeoutRef.current = setTimeout(() => {\r\n      if (socketRef.current && !socketRef.current.connected && !isConnected) {\r\n        console.log('ðŸ”Œ [LazySocketProvider] Attempting reconnection...');\r\n        socketRef.current.connect();\r\n      }\r\n    }, delay);\r\n  }, [isConnected, maxReconnectionAttempts]);\r\n\r\n  const connectSocket = useCallback(() => {\r\n    // Don't create connection if already connecting or connected\r\n    if (isConnecting || socketRef.current?.connected) {\r\n      return socketRef.current;\r\n    }\r\n\r\n    const serverUrl = getServerUrl();\r\n    console.log('ðŸ”Œ [LazySocketProvider] Connecting to server:', serverUrl);\r\n    setIsConnecting(true);\r\n\r\n    const newSocket = io(serverUrl, {\r\n      transports: ['websocket', 'polling'],\r\n      timeout: 20000, // 20 seconds\r\n      reconnection: false, // Disable automatic reconnection\r\n      forceNew: false, // Don't force new connections\r\n      autoConnect: false // Don't auto-connect\r\n    });\r\n\r\n    newSocket.on('connect', () => {\r\n      console.log('âœ… [LazySocketProvider] Connected to server. Socket ID:', newSocket.id);\r\n      setSocket(newSocket);\r\n      setSocketId(newSocket.id);\r\n      setIsConnected(true);\r\n      setIsConnecting(false);\r\n      reconnectionAttemptsRef.current = 0; // Reset reconnection attempts on successful connection\r\n      \r\n      // Clear any pending reconnection timeout\r\n      if (reconnectionTimeoutRef.current) {\r\n        clearTimeout(reconnectionTimeoutRef.current);\r\n        reconnectionTimeoutRef.current = null;\r\n      }\r\n    });\r\n\r\n    newSocket.on('disconnect', (reason) => {\r\n      console.log('âŒ [LazySocketProvider] Disconnected from server. Reason:', reason);\r\n      setIsConnected(false);\r\n      setIsConnecting(false);\r\n      \r\n      // Only attempt reconnection for certain disconnect reasons\r\n      if (reason === 'io server disconnect') {\r\n        console.log('ðŸ”„ [LazySocketProvider] Server initiated disconnect, attempting reconnection...');\r\n        attemptReconnection();\r\n      } else if (reason === 'transport close' || reason === 'transport error') {\r\n        console.log('ðŸ”„ [LazySocketProvider] Transport issue, attempting reconnection...');\r\n        attemptReconnection();\r\n      }\r\n    });\r\n\r\n    newSocket.on('connect_error', (error) => {\r\n      console.error('âŒ [LazySocketProvider] Connection error:', error);\r\n      setIsConnected(false);\r\n      setIsConnecting(false);\r\n      \r\n      // Attempt reconnection with backoff\r\n      attemptReconnection();\r\n    });\r\n\r\n    socketRef.current = newSocket;\r\n    \r\n    // Connect the socket\r\n    newSocket.connect();\r\n\r\n    return newSocket;\r\n  }, [getServerUrl, isConnecting, isConnected, attemptReconnection]);\r\n\r\n  const disconnectSocket = useCallback(() => {\r\n    if (socketRef.current) {\r\n      console.log('ðŸ§¹ [LazySocketProvider] Disconnecting socket');\r\n      \r\n      // Clear any pending reconnection timeout\r\n      if (reconnectionTimeoutRef.current) {\r\n        clearTimeout(reconnectionTimeoutRef.current);\r\n        reconnectionTimeoutRef.current = null;\r\n      }\r\n      \r\n      socketRef.current.disconnect();\r\n      socketRef.current = null;\r\n      setSocket(null);\r\n      setSocketId(null);\r\n      setIsConnected(false);\r\n      setIsConnecting(false);\r\n      reconnectionAttemptsRef.current = 0;\r\n    }\r\n  }, []);\r\n\r\n  // Cleanup on component unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      console.log('ðŸ§¹ [LazySocketProvider] Component unmounting, cleaning up...');\r\n      disconnectSocket();\r\n    };\r\n  }, [disconnectSocket]);\r\n\r\n  const value = {\r\n    socket,\r\n    socketId,\r\n    isConnected,\r\n    isConnecting,\r\n    connectSocket,\r\n    disconnectSocket,\r\n  };\r\n\r\n  return <SocketContext.Provider value={value}>{children}</SocketContext.Provider>;\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import _objectSpread from\"C:/Gamebuddies2/gamebuddies/Gamebuddies.Io/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useEffect,useRef}from'react';import{getSupabaseClient}from'./supabase';/**\r\n * Custom hook for Supabase Realtime subscriptions\r\n * @param {string} table - Table name to subscribe to\r\n * @param {Object} filters - Filters for the subscription\r\n * @param {Function} onInsert - Callback for INSERT events\r\n * @param {Function} onUpdate - Callback for UPDATE events\r\n * @param {Function} onDelete - Callback for DELETE events\r\n * @param {Array} dependencies - Dependencies array for useEffect\r\n * @param {boolean} enabled - Whether to enable the subscription (default: true)\r\n */export const useRealtimeSubscription=_ref=>{let{table,filters={},onInsert,onUpdate,onDelete,dependencies=[],enabled=true}=_ref;const subscriptionRef=useRef(null);const channelRef=useRef(null);useEffect(()=>{// Skip if not enabled or if filters are incomplete\nif(!enabled){console.log(\"\\uD83D\\uDD14 [REALTIME] Subscription disabled for table: \".concat(table));return;}// Check if filters have required values (especially for room-specific subscriptions)\nconst filterString=filters.filter;if(filterString&&filterString.includes('eq.null')){console.log(\"\\uD83D\\uDD14 [REALTIME] Skipping subscription for \".concat(table,\" - incomplete filter\"));return;}console.log(\"\\uD83D\\uDD14 [REALTIME] Setting up subscription for table: \".concat(table),filters);const setupSubscription=async()=>{try{const supabase=await getSupabaseClient();if(!supabase){console.error(\"\\u274C [REALTIME] Cannot setup subscription - Supabase client not available\");return;}// Clean up any existing subscription first\nif(channelRef.current){console.log(\"\\uD83E\\uDDF9 [REALTIME] Cleaning up existing subscription for \".concat(table));await supabase.removeChannel(channelRef.current);channelRef.current=null;subscriptionRef.current=null;}// Generate unique channel name to avoid conflicts\nconst timestamp=Date.now();const randomId=Math.random().toString(36).substring(7);const channelName=\"\".concat(table,\"_changes_\").concat(timestamp,\"_\").concat(randomId);// Create subscription\nconst channel=supabase.channel(channelName).on('postgres_changes',_objectSpread({event:'*',schema:'public',table:table},filters),payload=>{console.log(\"\\uD83D\\uDD14 [REALTIME] \".concat(table,\" change:\"),payload);switch(payload.eventType){case'INSERT':if(onInsert)onInsert(payload.new,payload);break;case'UPDATE':if(onUpdate)onUpdate(payload.new,payload.old,payload);break;case'DELETE':if(onDelete)onDelete(payload.old,payload);break;default:console.log(\"\\uD83D\\uDD14 [REALTIME] Unknown event type: \".concat(payload.eventType));}});const subscription=await channel.subscribe(status=>{console.log(\"\\uD83D\\uDD14 [REALTIME] Subscription status for \".concat(table,\":\"),status);if(status==='SUBSCRIBED'){console.log(\"\\u2705 [REALTIME] Successfully subscribed to \".concat(table));}else if(status==='CLOSED'||status==='CHANNEL_ERROR'){console.error(\"\\u274C [REALTIME] Subscription error for \".concat(table,\":\"),status);}});channelRef.current=channel;subscriptionRef.current=subscription;}catch(error){console.error(\"\\u274C [REALTIME] Error setting up subscription for \".concat(table,\":\"),error);}};setupSubscription();// Cleanup function\nreturn()=>{console.log(\"\\uD83E\\uDDF9 [REALTIME] Cleaning up subscription for \".concat(table));if(channelRef.current){getSupabaseClient().then(async supabase=>{if(supabase&&channelRef.current){try{await supabase.removeChannel(channelRef.current);console.log(\"\\u2705 [REALTIME] Successfully cleaned up subscription for \".concat(table));}catch(error){console.error(\"\\u274C [REALTIME] Error cleaning up subscription for \".concat(table,\":\"),error);}}});channelRef.current=null;subscriptionRef.current=null;}};},dependencies);return subscriptionRef.current;};export default useRealtimeSubscription;","map":{"version":3,"names":["useEffect","useRef","getSupabaseClient","useRealtimeSubscription","_ref","table","filters","onInsert","onUpdate","onDelete","dependencies","enabled","subscriptionRef","channelRef","console","log","concat","filterString","filter","includes","setupSubscription","supabase","error","current","removeChannel","timestamp","Date","now","randomId","Math","random","toString","substring","channelName","channel","on","_objectSpread","event","schema","payload","eventType","new","old","subscription","subscribe","status","then"],"sources":["C:/Gamebuddies2/gamebuddies/Gamebuddies.Io/client/src/utils/useRealtimeSubscription.js"],"sourcesContent":["import { useEffect, useRef } from 'react';\r\nimport { getSupabaseClient } from './supabase';\r\n\r\n/**\r\n * Custom hook for Supabase Realtime subscriptions\r\n * @param {string} table - Table name to subscribe to\r\n * @param {Object} filters - Filters for the subscription\r\n * @param {Function} onInsert - Callback for INSERT events\r\n * @param {Function} onUpdate - Callback for UPDATE events\r\n * @param {Function} onDelete - Callback for DELETE events\r\n * @param {Array} dependencies - Dependencies array for useEffect\r\n * @param {boolean} enabled - Whether to enable the subscription (default: true)\r\n */\r\nexport const useRealtimeSubscription = ({\r\n  table,\r\n  filters = {},\r\n  onInsert,\r\n  onUpdate,\r\n  onDelete,\r\n  dependencies = [],\r\n  enabled = true\r\n}) => {\r\n  const subscriptionRef = useRef(null);\r\n  const channelRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    // Skip if not enabled or if filters are incomplete\r\n    if (!enabled) {\r\n      console.log(`üîî [REALTIME] Subscription disabled for table: ${table}`);\r\n      return;\r\n    }\r\n\r\n    // Check if filters have required values (especially for room-specific subscriptions)\r\n    const filterString = filters.filter;\r\n    if (filterString && filterString.includes('eq.null')) {\r\n      console.log(`üîî [REALTIME] Skipping subscription for ${table} - incomplete filter`);\r\n      return;\r\n    }\r\n\r\n    console.log(`üîî [REALTIME] Setting up subscription for table: ${table}`, filters);\r\n\r\n    const setupSubscription = async () => {\r\n      try {\r\n        const supabase = await getSupabaseClient();\r\n        if (!supabase) {\r\n          console.error(`‚ùå [REALTIME] Cannot setup subscription - Supabase client not available`);\r\n          return;\r\n        }\r\n\r\n        // Clean up any existing subscription first\r\n        if (channelRef.current) {\r\n          console.log(`üßπ [REALTIME] Cleaning up existing subscription for ${table}`);\r\n          await supabase.removeChannel(channelRef.current);\r\n          channelRef.current = null;\r\n          subscriptionRef.current = null;\r\n        }\r\n\r\n        // Generate unique channel name to avoid conflicts\r\n        const timestamp = Date.now();\r\n        const randomId = Math.random().toString(36).substring(7);\r\n        const channelName = `${table}_changes_${timestamp}_${randomId}`;\r\n        \r\n        // Create subscription\r\n        const channel = supabase\r\n          .channel(channelName)\r\n          .on(\r\n            'postgres_changes',\r\n            {\r\n              event: '*',\r\n              schema: 'public',\r\n              table: table,\r\n              ...filters\r\n            },\r\n            (payload) => {\r\n              console.log(`üîî [REALTIME] ${table} change:`, payload);\r\n              \r\n              switch (payload.eventType) {\r\n                case 'INSERT':\r\n                  if (onInsert) onInsert(payload.new, payload);\r\n                  break;\r\n                case 'UPDATE':\r\n                  if (onUpdate) onUpdate(payload.new, payload.old, payload);\r\n                  break;\r\n                case 'DELETE':\r\n                  if (onDelete) onDelete(payload.old, payload);\r\n                  break;\r\n                default:\r\n                  console.log(`üîî [REALTIME] Unknown event type: ${payload.eventType}`);\r\n              }\r\n            }\r\n          );\r\n\r\n        const subscription = await channel.subscribe((status) => {\r\n          console.log(`üîî [REALTIME] Subscription status for ${table}:`, status);\r\n          if (status === 'SUBSCRIBED') {\r\n            console.log(`‚úÖ [REALTIME] Successfully subscribed to ${table}`);\r\n          } else if (status === 'CLOSED' || status === 'CHANNEL_ERROR') {\r\n            console.error(`‚ùå [REALTIME] Subscription error for ${table}:`, status);\r\n          }\r\n        });\r\n\r\n        channelRef.current = channel;\r\n        subscriptionRef.current = subscription;\r\n      } catch (error) {\r\n        console.error(`‚ùå [REALTIME] Error setting up subscription for ${table}:`, error);\r\n      }\r\n    };\r\n\r\n    setupSubscription();\r\n\r\n    // Cleanup function\r\n    return () => {\r\n      console.log(`üßπ [REALTIME] Cleaning up subscription for ${table}`);\r\n      if (channelRef.current) {\r\n        getSupabaseClient().then(async (supabase) => {\r\n          if (supabase && channelRef.current) {\r\n            try {\r\n              await supabase.removeChannel(channelRef.current);\r\n              console.log(`‚úÖ [REALTIME] Successfully cleaned up subscription for ${table}`);\r\n            } catch (error) {\r\n              console.error(`‚ùå [REALTIME] Error cleaning up subscription for ${table}:`, error);\r\n            }\r\n          }\r\n        });\r\n        channelRef.current = null;\r\n        subscriptionRef.current = null;\r\n      }\r\n    };\r\n  }, dependencies);\r\n\r\n  return subscriptionRef.current;\r\n};\r\n\r\nexport default useRealtimeSubscription; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}